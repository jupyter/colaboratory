goog.provide("goog.async.nextTick");goog.provide("goog.async.throwException");goog.require("goog.debug.entryPointRegistry");goog.require("goog.functions");goog.async.throwException=function(exception){goog.global.setTimeout(function(){throw exception;},0)};
goog.async.nextTick=function(callback,opt_context){var cb=callback;if(opt_context)cb=goog.bind(callback,opt_context);cb=goog.async.nextTick.wrapCallback_(cb);if(goog.isFunction(goog.global.setImmediate)){goog.global.setImmediate(cb);return}if(!goog.async.nextTick.setImmediate_)goog.async.nextTick.setImmediate_=goog.async.nextTick.getSetImmediateEmulator_();goog.async.nextTick.setImmediate_(cb)};goog.async.nextTick.setImmediate_;
goog.async.nextTick.getSetImmediateEmulator_=function(){if(goog.global.Promise&&goog.global.Promise.resolve){var promise=goog.global.Promise.resolve();return function(cb){promise.then(function(){try{cb()}catch(e){goog.async.throwException(e)}})}}var Channel=goog.global["MessageChannel"];if(typeof Channel==="undefined"&&(typeof window!=="undefined"&&(window.postMessage&&window.addEventListener)))Channel=function(){var iframe=document.createElement("iframe");iframe.style.display="none";iframe.src="";
document.documentElement.appendChild(iframe);var win=iframe.contentWindow;var doc=win.document;doc.open();doc.write("");doc.close();var message="callImmediate"+Math.random();var origin=win.location.protocol+"//"+win.location.host;var onmessage=goog.bind(function(e){if(e.origin!=origin&&e.data!=message)return;this["port1"].onmessage()},this);win.addEventListener("message",onmessage,false);this["port1"]={};this["port2"]={postMessage:function(){win.postMessage(message,origin)}}};if(typeof Channel!==
"undefined"){var channel=new Channel;var head={};var tail=head;channel["port1"].onmessage=function(){head=head.next;var cb=head.cb;head.cb=null;cb()};return function(cb){tail.next={cb:cb};tail=tail.next;channel["port2"].postMessage(0)}}if(typeof document!=="undefined"&&"onreadystatechange"in document.createElement("script"))return function(cb){var script=document.createElement("script");script.onreadystatechange=function(){script.onreadystatechange=null;script.parentNode.removeChild(script);script=
null;cb();cb=null};document.documentElement.appendChild(script)};return function(cb){goog.global.setTimeout(cb,0)}};goog.async.nextTick.wrapCallback_=goog.functions.identity;goog.debug.entryPointRegistry.register(function(transformer){goog.async.nextTick.wrapCallback_=transformer});goog.provide("goog.testing.watchers");goog.testing.watchers.resetWatchers_=[];goog.testing.watchers.signalClockReset=function(){var watchers=goog.testing.watchers.resetWatchers_;for(var i=0;i<watchers.length;i++)goog.testing.watchers.resetWatchers_[i]()};goog.testing.watchers.watchClockReset=function(fn){goog.testing.watchers.resetWatchers_.push(fn)};goog.provide("goog.async.run");goog.require("goog.async.nextTick");goog.require("goog.async.throwException");goog.require("goog.testing.watchers");goog.async.run=function(callback,opt_context){if(!goog.async.run.workQueueScheduled_){goog.async.nextTick(goog.async.run.processWorkQueue);goog.async.run.workQueueScheduled_=true}goog.async.run.workQueue_.push(new goog.async.run.WorkItem_(callback,opt_context))};goog.async.run.workQueueScheduled_=false;goog.async.run.workQueue_=[];
if(goog.DEBUG){goog.async.run.resetQueue_=function(){goog.async.run.workQueueScheduled_=false;goog.async.run.workQueue_=[]};goog.testing.watchers.watchClockReset(goog.async.run.resetQueue_)}
goog.async.run.processWorkQueue=function(){while(goog.async.run.workQueue_.length){var workItems=goog.async.run.workQueue_;goog.async.run.workQueue_=[];for(var i=0;i<workItems.length;i++){var workItem=workItems[i];try{workItem.fn.call(workItem.scope)}catch(e){goog.async.throwException(e)}}}goog.async.run.workQueueScheduled_=false};goog.async.run.WorkItem_=function(fn,scope){this.fn=fn;this.scope=scope};goog.provide("goog.promise.Resolver");goog.promise.Resolver=function(){};goog.promise.Resolver.prototype.promise;goog.promise.Resolver.prototype.resolve;goog.promise.Resolver.prototype.reject;goog.provide("goog.Thenable");goog.Thenable=function(){};goog.Thenable.prototype.then=function(opt_onFulfilled,opt_onRejected,opt_context){};goog.Thenable.IMPLEMENTED_BY_PROP="$goog_Thenable";goog.Thenable.addImplementation=function(ctor){goog.exportProperty(ctor.prototype,"then",ctor.prototype.then);if(COMPILED)ctor.prototype[goog.Thenable.IMPLEMENTED_BY_PROP]=true;else ctor.prototype.$goog_Thenable=true};
goog.Thenable.isImplementedBy=function(object){if(!object)return false;try{if(COMPILED)return!!object[goog.Thenable.IMPLEMENTED_BY_PROP];return!!object.$goog_Thenable}catch(e){return false}};goog.provide("goog.Promise");goog.require("goog.Thenable");goog.require("goog.asserts");goog.require("goog.async.run");goog.require("goog.async.throwException");goog.require("goog.debug.Error");goog.require("goog.promise.Resolver");
goog.Promise=function(resolver,opt_context){this.state_=goog.Promise.State_.PENDING;this.result_=undefined;this.parent_=null;this.callbackEntries_=null;this.executing_=false;if(goog.Promise.UNHANDLED_REJECTION_DELAY>0)this.unhandledRejectionId_=0;else if(goog.Promise.UNHANDLED_REJECTION_DELAY==0)this.hadUnhandledRejection_=false;if(goog.Promise.LONG_STACK_TRACES){this.stack_=[];this.addStackTrace_(new Error("created"));this.currentStep_=0}try{var self=this;resolver.call(opt_context,function(value){self.resolve_(goog.Promise.State_.FULFILLED,
value)},function(reason){self.resolve_(goog.Promise.State_.REJECTED,reason)})}catch(e){this.resolve_(goog.Promise.State_.REJECTED,e)}};goog.define("goog.Promise.LONG_STACK_TRACES",goog.DEBUG);goog.define("goog.Promise.UNHANDLED_REJECTION_DELAY",0);goog.Promise.State_={PENDING:0,BLOCKED:1,FULFILLED:2,REJECTED:3};goog.Promise.CallbackEntry_;goog.Promise.resolve=function(opt_value){return new goog.Promise(function(resolve,reject){resolve(opt_value)})};
goog.Promise.reject=function(opt_reason){return new goog.Promise(function(resolve,reject){reject(opt_reason)})};goog.Promise.race=function(promises){return new goog.Promise(function(resolve,reject){if(!promises.length)resolve(undefined);for(var i=0,promise;promise=promises[i];i++)promise.then(resolve,reject)})};
goog.Promise.all=function(promises){return new goog.Promise(function(resolve,reject){var toFulfill=promises.length;var values=[];if(!toFulfill){resolve(values);return}var onFulfill=function(index,value){toFulfill--;values[index]=value;if(toFulfill==0)resolve(values)};var onReject=function(reason){reject(reason)};for(var i=0,promise;promise=promises[i];i++)promise.then(goog.partial(onFulfill,i),onReject)})};
goog.Promise.firstFulfilled=function(promises){return new goog.Promise(function(resolve,reject){var toReject=promises.length;var reasons=[];if(!toReject){resolve(undefined);return}var onFulfill=function(value){resolve(value)};var onReject=function(index,reason){toReject--;reasons[index]=reason;if(toReject==0)reject(reasons)};for(var i=0,promise;promise=promises[i];i++)promise.then(onFulfill,goog.partial(onReject,i))})};
goog.Promise.withResolver=function(){var resolve,reject;var promise=new goog.Promise(function(rs,rj){resolve=rs;reject=rj});return new goog.Promise.Resolver_(promise,resolve,reject)};
goog.Promise.prototype.then=function(opt_onFulfilled,opt_onRejected,opt_context){if(opt_onFulfilled!=null)goog.asserts.assertFunction(opt_onFulfilled,"opt_onFulfilled should be a function.");if(opt_onRejected!=null)goog.asserts.assertFunction(opt_onRejected,"opt_onRejected should be a function. Did you pass opt_context "+"as the second argument instead of the third?");if(goog.Promise.LONG_STACK_TRACES)this.addStackTrace_(new Error("then"));return this.addChildPromise_(goog.isFunction(opt_onFulfilled)?
opt_onFulfilled:null,goog.isFunction(opt_onRejected)?opt_onRejected:null,opt_context)};goog.Thenable.addImplementation(goog.Promise);goog.Promise.prototype.thenAlways=function(onResolved,opt_context){if(goog.Promise.LONG_STACK_TRACES)this.addStackTrace_(new Error("thenAlways"));var callback=function(){try{onResolved.call(opt_context)}catch(err){goog.Promise.handleRejection_.call(null,err)}};this.addCallbackEntry_({child:null,onRejected:callback,onFulfilled:callback});return this};
goog.Promise.prototype.thenCatch=function(onRejected,opt_context){if(goog.Promise.LONG_STACK_TRACES)this.addStackTrace_(new Error("thenCatch"));return this.addChildPromise_(null,onRejected,opt_context)};goog.Promise.prototype.cancel=function(opt_message){if(this.state_==goog.Promise.State_.PENDING)goog.async.run(function(){var err=new goog.Promise.CancellationError(opt_message);this.cancelInternal_(err)},this)};
goog.Promise.prototype.cancelInternal_=function(err){if(this.state_==goog.Promise.State_.PENDING)if(this.parent_)this.parent_.cancelChild_(this,err);else this.resolve_(goog.Promise.State_.REJECTED,err)};
goog.Promise.prototype.cancelChild_=function(childPromise,err){if(!this.callbackEntries_)return;var childCount=0;var childIndex=-1;for(var i=0,entry;entry=this.callbackEntries_[i];i++){var child=entry.child;if(child){childCount++;if(child==childPromise)childIndex=i;if(childIndex>=0&&childCount>1)break}}if(childIndex>=0)if(this.state_==goog.Promise.State_.PENDING&&childCount==1)this.cancelInternal_(err);else{var callbackEntry=this.callbackEntries_.splice(childIndex,1)[0];this.executeCallback_(callbackEntry,
goog.Promise.State_.REJECTED,err)}};goog.Promise.prototype.addCallbackEntry_=function(callbackEntry){if((!this.callbackEntries_||!this.callbackEntries_.length)&&(this.state_==goog.Promise.State_.FULFILLED||this.state_==goog.Promise.State_.REJECTED))this.scheduleCallbacks_();if(!this.callbackEntries_)this.callbackEntries_=[];this.callbackEntries_.push(callbackEntry)};
goog.Promise.prototype.addChildPromise_=function(onFulfilled,onRejected,opt_context){var callbackEntry={child:null,onFulfilled:null,onRejected:null};callbackEntry.child=new goog.Promise(function(resolve,reject){callbackEntry.onFulfilled=onFulfilled?function(value){try{var result=onFulfilled.call(opt_context,value);resolve(result)}catch(err){reject(err)}}:resolve;callbackEntry.onRejected=onRejected?function(reason){try{var result=onRejected.call(opt_context,reason);if(!goog.isDef(result)&&reason instanceof
goog.Promise.CancellationError)reject(reason);else resolve(result)}catch(err){reject(err)}}:reject});callbackEntry.child.parent_=this;this.addCallbackEntry_((callbackEntry));return callbackEntry.child};goog.Promise.prototype.unblockAndFulfill_=function(value){goog.asserts.assert(this.state_==goog.Promise.State_.BLOCKED);this.state_=goog.Promise.State_.PENDING;this.resolve_(goog.Promise.State_.FULFILLED,value)};
goog.Promise.prototype.unblockAndReject_=function(reason){goog.asserts.assert(this.state_==goog.Promise.State_.BLOCKED);this.state_=goog.Promise.State_.PENDING;this.resolve_(goog.Promise.State_.REJECTED,reason)};
goog.Promise.prototype.resolve_=function(state,x){if(this.state_!=goog.Promise.State_.PENDING)return;if(this==x){state=goog.Promise.State_.REJECTED;x=new TypeError("Promise cannot resolve to itself")}else if(goog.Thenable.isImplementedBy(x)){x=(x);this.state_=goog.Promise.State_.BLOCKED;x.then(this.unblockAndFulfill_,this.unblockAndReject_,this);return}else if(goog.isObject(x))try{var then=x["then"];if(goog.isFunction(then)){this.tryThen_(x,then);return}}catch(e){state=goog.Promise.State_.REJECTED;
x=e}this.result_=x;this.state_=state;this.scheduleCallbacks_();if(state==goog.Promise.State_.REJECTED&&!(x instanceof goog.Promise.CancellationError))goog.Promise.addUnhandledRejection_(this,x)};
goog.Promise.prototype.tryThen_=function(thenable,then){this.state_=goog.Promise.State_.BLOCKED;var promise=this;var called=false;var resolve=function(value){if(!called){called=true;promise.unblockAndFulfill_(value)}};var reject=function(reason){if(!called){called=true;promise.unblockAndReject_(reason)}};try{then.call(thenable,resolve,reject)}catch(e){reject(e)}};goog.Promise.prototype.scheduleCallbacks_=function(){if(!this.executing_){this.executing_=true;goog.async.run(this.executeCallbacks_,this)}};
goog.Promise.prototype.executeCallbacks_=function(){while(this.callbackEntries_&&this.callbackEntries_.length){var entries=this.callbackEntries_;this.callbackEntries_=[];for(var i=0;i<entries.length;i++){if(goog.Promise.LONG_STACK_TRACES)this.currentStep_++;this.executeCallback_(entries[i],this.state_,this.result_)}}this.executing_=false};
goog.Promise.prototype.executeCallback_=function(callbackEntry,state,result){if(state==goog.Promise.State_.FULFILLED)callbackEntry.onFulfilled(result);else{this.removeUnhandledRejection_();callbackEntry.onRejected(result)}};goog.Promise.prototype.addStackTrace_=function(err){if(goog.Promise.LONG_STACK_TRACES&&goog.isString(err.stack)){var trace=err.stack.split("\n",4)[3];var message=err.message;message+=Array(11-message.length).join(" ");this.stack_.push(message+trace)}};
goog.Promise.prototype.appendLongStack_=function(err){if(goog.Promise.LONG_STACK_TRACES&&(err&&(goog.isString(err.stack)&&this.stack_.length))){var longTrace=["Promise trace:"];for(var promise=this;promise;promise=promise.parent_){for(var i=this.currentStep_;i>=0;i--)longTrace.push(promise.stack_[i]);longTrace.push("Value: "+"["+(promise.state_==goog.Promise.State_.REJECTED?"REJECTED":"FULFILLED")+"] "+"<"+String(promise.result_)+">")}err.stack+="\n\n"+longTrace.join("\n")}};
goog.Promise.prototype.removeUnhandledRejection_=function(){if(goog.Promise.UNHANDLED_REJECTION_DELAY>0)for(var p=this;p&&p.unhandledRejectionId_;p=p.parent_){goog.global.clearTimeout(p.unhandledRejectionId_);p.unhandledRejectionId_=0}else if(goog.Promise.UNHANDLED_REJECTION_DELAY==0)for(var p=this;p&&p.hadUnhandledRejection_;p=p.parent_)p.hadUnhandledRejection_=false};
goog.Promise.addUnhandledRejection_=function(promise,reason){if(goog.Promise.UNHANDLED_REJECTION_DELAY>0)promise.unhandledRejectionId_=goog.global.setTimeout(function(){promise.appendLongStack_(reason);goog.Promise.handleRejection_.call(null,reason)},goog.Promise.UNHANDLED_REJECTION_DELAY);else if(goog.Promise.UNHANDLED_REJECTION_DELAY==0){promise.hadUnhandledRejection_=true;goog.async.run(function(){if(promise.hadUnhandledRejection_){promise.appendLongStack_(reason);goog.Promise.handleRejection_.call(null,
reason)}})}};goog.Promise.handleRejection_=goog.async.throwException;goog.Promise.setUnhandledRejectionHandler=function(handler){goog.Promise.handleRejection_=handler};goog.Promise.CancellationError=function(opt_message){goog.Promise.CancellationError.base(this,"constructor",opt_message)};goog.inherits(goog.Promise.CancellationError,goog.debug.Error);goog.Promise.CancellationError.prototype.name="cancel";
goog.Promise.Resolver_=function(promise,resolve,reject){this.promise=promise;this.resolve=resolve;this.reject=reject};goog.provide("goog.string.format");goog.require("goog.string");
goog.string.format=function(formatString,var_args){var args=Array.prototype.slice.call(arguments);var template=args.shift();if(typeof template=="undefined")throw Error("[goog.string.format] Template required");var formatRe=/%([0\-\ \+]*)(\d+)?(\.(\d+))?([%sfdiu])/g;function replacerDemuxer(match,flags,width,dotp,precision,type,offset,wholeString){if(type=="%")return"%";var value=args.shift();if(typeof value=="undefined")throw Error("[goog.string.format] Not enough arguments");arguments[0]=value;return goog.string.format.demuxes_[type].apply(null,
arguments)}return template.replace(formatRe,replacerDemuxer)};goog.string.format.demuxes_={};goog.string.format.demuxes_["s"]=function(value,flags,width,dotp,precision,type,offset,wholeString){var replacement=value;if(isNaN(width)||(width==""||replacement.length>=width))return replacement;if(flags.indexOf("-",0)>-1)replacement=replacement+goog.string.repeat(" ",width-replacement.length);else replacement=goog.string.repeat(" ",width-replacement.length)+replacement;return replacement};
goog.string.format.demuxes_["f"]=function(value,flags,width,dotp,precision,type,offset,wholeString){var replacement=value.toString();if(!(isNaN(precision)||precision==""))replacement=value.toFixed(precision);var sign;if(value<0)sign="-";else if(flags.indexOf("+")>=0)sign="+";else if(flags.indexOf(" ")>=0)sign=" ";else sign="";if(value>=0)replacement=sign+replacement;if(isNaN(width)||replacement.length>=width)return replacement;replacement=isNaN(precision)?Math.abs(value).toString():Math.abs(value).toFixed(precision);
var padCount=width-replacement.length-sign.length;if(flags.indexOf("-",0)>=0)replacement=sign+replacement+goog.string.repeat(" ",padCount);else{var paddingChar=flags.indexOf("0",0)>=0?"0":" ";replacement=sign+goog.string.repeat(paddingChar,padCount)+replacement}return replacement};goog.string.format.demuxes_["d"]=function(value,flags,width,dotp,precision,type,offset,wholeString){return goog.string.format.demuxes_["f"](parseInt(value,10),flags,width,dotp,0,type,offset,wholeString)};
goog.string.format.demuxes_["i"]=goog.string.format.demuxes_["d"];goog.string.format.demuxes_["u"]=goog.string.format.demuxes_["d"];goog.provide("goog.format.JsonPrettyPrinter");goog.provide("goog.format.JsonPrettyPrinter.HtmlDelimiters");goog.provide("goog.format.JsonPrettyPrinter.TextDelimiters");goog.require("goog.json");goog.require("goog.json.Serializer");goog.require("goog.string");goog.require("goog.string.StringBuffer");goog.require("goog.string.format");goog.format.JsonPrettyPrinter=function(delimiters){this.delimiters_=delimiters||new goog.format.JsonPrettyPrinter.TextDelimiters;this.jsonSerializer_=new goog.json.Serializer};
goog.format.JsonPrettyPrinter.prototype.format=function(json){if(!goog.isDefAndNotNull(json))return"";if(goog.isString(json)){if(goog.string.isEmpty(json))return"";json=goog.json.parse(json)}var outputBuffer=new goog.string.StringBuffer;this.printObject_(json,outputBuffer,0);return outputBuffer.toString()};
goog.format.JsonPrettyPrinter.prototype.printObject_=function(val,outputBuffer,indent){var typeOf=goog.typeOf(val);switch(typeOf){case "null":case "boolean":case "number":case "string":this.printValue_((val),typeOf,outputBuffer);break;case "array":outputBuffer.append(this.delimiters_.arrayStart);var i=0;for(i=0;i<val.length;i++){if(i>0)outputBuffer.append(this.delimiters_.propertySeparator);outputBuffer.append(this.delimiters_.lineBreak);this.printSpaces_(indent+this.delimiters_.indent,outputBuffer);
this.printObject_(val[i],outputBuffer,indent+this.delimiters_.indent)}if(i>0){outputBuffer.append(this.delimiters_.lineBreak);this.printSpaces_(indent,outputBuffer)}outputBuffer.append(this.delimiters_.arrayEnd);break;case "object":outputBuffer.append(this.delimiters_.objectStart);var propertyCount=0;for(var name in val){if(!val.hasOwnProperty(name))continue;if(propertyCount>0)outputBuffer.append(this.delimiters_.propertySeparator);outputBuffer.append(this.delimiters_.lineBreak);this.printSpaces_(indent+
this.delimiters_.indent,outputBuffer);this.printName_(name,outputBuffer);outputBuffer.append(this.delimiters_.nameValueSeparator,this.delimiters_.space);this.printObject_(val[name],outputBuffer,indent+this.delimiters_.indent);propertyCount++}if(propertyCount>0){outputBuffer.append(this.delimiters_.lineBreak);this.printSpaces_(indent,outputBuffer)}outputBuffer.append(this.delimiters_.objectEnd);break;default:this.printValue_("","unknown",outputBuffer)}};
goog.format.JsonPrettyPrinter.prototype.printName_=function(name,outputBuffer){outputBuffer.append(this.delimiters_.preName,this.jsonSerializer_.serialize(name),this.delimiters_.postName)};goog.format.JsonPrettyPrinter.prototype.printValue_=function(val,typeOf,outputBuffer){outputBuffer.append(goog.string.format(this.delimiters_.preValue,typeOf),this.jsonSerializer_.serialize(val),goog.string.format(this.delimiters_.postValue,typeOf))};
goog.format.JsonPrettyPrinter.prototype.printSpaces_=function(indent,outputBuffer){outputBuffer.append(goog.string.repeat(this.delimiters_.space,indent))};goog.format.JsonPrettyPrinter.TextDelimiters=function(){};goog.format.JsonPrettyPrinter.TextDelimiters.prototype.space=" ";goog.format.JsonPrettyPrinter.TextDelimiters.prototype.lineBreak="\n";goog.format.JsonPrettyPrinter.TextDelimiters.prototype.objectStart="{";goog.format.JsonPrettyPrinter.TextDelimiters.prototype.objectEnd="}";
goog.format.JsonPrettyPrinter.TextDelimiters.prototype.arrayStart="[";goog.format.JsonPrettyPrinter.TextDelimiters.prototype.arrayEnd="]";goog.format.JsonPrettyPrinter.TextDelimiters.prototype.propertySeparator=",";goog.format.JsonPrettyPrinter.TextDelimiters.prototype.nameValueSeparator=":";goog.format.JsonPrettyPrinter.TextDelimiters.prototype.preName="";goog.format.JsonPrettyPrinter.TextDelimiters.prototype.postName="";goog.format.JsonPrettyPrinter.TextDelimiters.prototype.preValue="";
goog.format.JsonPrettyPrinter.TextDelimiters.prototype.postValue="";goog.format.JsonPrettyPrinter.TextDelimiters.prototype.indent=2;goog.format.JsonPrettyPrinter.HtmlDelimiters=function(){goog.format.JsonPrettyPrinter.TextDelimiters.call(this)};goog.inherits(goog.format.JsonPrettyPrinter.HtmlDelimiters,goog.format.JsonPrettyPrinter.TextDelimiters);goog.format.JsonPrettyPrinter.HtmlDelimiters.prototype.preName='<span class="'+goog.getCssName("goog-jsonprettyprinter-propertyname")+'">';
goog.format.JsonPrettyPrinter.HtmlDelimiters.prototype.postName="</span>";goog.format.JsonPrettyPrinter.HtmlDelimiters.prototype.preValue='<span class="'+goog.getCssName("goog-jsonprettyprinter-propertyvalue")+'-%s">';goog.format.JsonPrettyPrinter.HtmlDelimiters.prototype.postValue="</span>";goog.provide("colab.params");goog.require("goog.Promise");goog.require("goog.style");colab.params.decodeParamString=function(paramString){var pairStrings=paramString.split("&");var params={};for(var i=0;i<pairStrings.length;i++){var pair=pairStrings[i].split("=");if(pair.length==2)params[decodeURIComponent(pair[0])]=decodeURIComponent(pair[1])}return params};
colab.params.encodeParamString=function(params){var pairs=[];for(var key in params){var value=params[key];var pair=encodeURIComponent(key)+"="+encodeURIComponent(value);pairs.push(pair)}return pairs.join("&")};colab.params.getSearchParams=function(){return colab.params.decodeParamString(window.location.search.slice(1))};colab.params.getHashParams=function(){return(colab.params.decodeParamString(window.location.hash.slice(1)))};colab.params.getNotebookUrl=function(params){return"/v2/notebook#"+colab.params.encodeParamString(params)};
colab.params.redirectToNotebook=function(params){window.location.href=colab.params.getNotebookUrl(params)};colab.params.getNewNotebookUrl=function(){return colab.params.getNotebookUrl({"create":true})};colab.params.newNotebookHash=function(){return"#create=true"};colab.params.existingNotebookHash=function(fileId){return"#fileId="+fileId};goog.provide("colab.app");goog.require("colab.params");colab.app.appMode=colab.params.getHashParams().mode==="app";colab.app.extensionOrigin_=colab.params.getHashParams().extensionOrigin;colab.app.addChromeAppListener=function(callback){window.addEventListener("message",function(message){if(message.origin!=colab.app.extensionOrigin_)return;callback(message.data,{source:message.source,origin:message.origin})})};goog.provide("colab.drive");goog.provide("colab.drive.Permissions");goog.require("colab.app");goog.require("goog.Promise");goog.require("goog.format.JsonPrettyPrinter");colab.drive.Permissions=function(editable,opt_commentable){this.editable_=editable;this.commentable_=opt_commentable};colab.drive.Permissions.prototype.isEditable=function(){return this.editable_};colab.drive.Permissions.prototype.isCommentable=function(){return!!(this.editable_||this.commentable_)};
colab.drive.NEW_NOTEBOOK_TITLE="Untitled.ipynb";colab.drive.NEW_NOTEBOOK_MIMETYPE="application/colab";colab.drive.NOTEBOOK_MIMETYPE="application/colab";colab.drive.FILE_SCOPE="https://www.googleapis.com/auth/drive";colab.drive.NEW_CLIENT_ID="911569945122-hpps2slo3mri3uk7lpc032vfudausme9"+".apps.googleusercontent.com";colab.drive.INSTALL_CLIENT_ID="26410270374-q0d0ap400g3mescci580rj5449tg2iq9"+".apps.googleusercontent.com";
colab.drive.CLIENT_ID=colab.params.getHashParams().legacyClient?colab.drive.INSTALL_CLIENT_ID:colab.drive.NEW_CLIENT_ID;colab.APP_ID="26410270374";colab.drive.JSON_FORMATTER_=new goog.format.JsonPrettyPrinter(null);colab.drive.MULTIPART_BOUNDARY="-------314159265358979323846";colab.drive.onClientLoad=function(){gapi.load("auth:client,drive-realtime,drive-share",colab.drive.clientLoadedResolve)};colab.drive.clientLoadedResolve=null;goog.exportSymbol("onClientLoad",colab.drive.onClientLoad);
colab.drive.clientLoaded=new goog.Promise(function(resolve,reject){colab.drive.clientLoadedResolve=resolve});colab.drive.apiLoaded=new goog.Promise(function(resolve,reject){colab.drive.clientLoaded.then(function(){gapi.client.load("drive","v2",resolve)})});colab.drive.userInfoLoaded=new goog.Promise(function(resolve,reject){colab.drive.clientLoaded.then(function(){gapi.client.load("plus","v1",resolve)})});colab.drive.myInfo=null;
colab.drive.userInfoPromise=new goog.Promise(function(resolve,reject){colab.drive.userInfoLoaded.then(function(){colab.drive.authorized.then(function(){var request=gapi.client.plus.people.get({"userId":"me"});request.execute(function(json){var resp=(json);if(resp.error){reject(resp.error);return}resolve(resp);colab.drive.myInfo=resp})})},reject)});
colab.drive.authorize=function(onSuccess,onFailure,opt_withPopup){var doAuthorize=function(){gapi.auth.authorize({"client_id":colab.drive.CLIENT_ID,"scope":["email",colab.drive.FILE_SCOPE],"immediate":!opt_withPopup},function(response){if(response&&!response["error"])onSuccess();else if(opt_withPopup){console.error(response);onFailure(response["error"]||"")}else colab.drive.authorize(onSuccess,onFailure,true)})};if(!opt_withPopup){doAuthorize();return}var dialog=new goog.ui.Dialog;dialog.setDisposeOnHide(true);
dialog.setContent("Click OK to launch the authorization popup window.");dialog.setTitle("Authorization Needed");dialog.setButtonSet(goog.ui.Dialog.ButtonSet.createOk());goog.events.listen(dialog,goog.ui.Dialog.EventType.SELECT,function(e){doAuthorize()});dialog.setVisible(true)};
colab.drive.authorized=new goog.Promise(function(resolve,reject){if(colab.app.appMode){var receivedToken=false;colab.app.addChromeAppListener(function(data,metadata){if(data.token){gapi.auth.setToken({"access_token":data.token});if(!receivedToken){resolve(null);receivedToken=true}}})}else colab.drive.clientLoaded.then(function(){colab.drive.authorize((resolve),reject);window.setInterval(function(){colab.drive.authorize(function(){},function(reason){console.log("failed to refresh OAuth token")})},
40*60*1E3)})});colab.drive.driveApiReady=goog.Promise.all([colab.drive.apiLoaded,colab.drive.authorized]);colab.drive.fileId=goog.Promise.withResolver();colab.drive.fileIdIfAvailable=undefined;colab.drive.fileDriveUrl=goog.Promise.withResolver();colab.drive.rootFolderId=null;colab.drive.userPermissionId="";colab.drive.driveApiReady.then(function(){var request=gapi.client.drive.about.get();request.execute(function(resp){colab.drive.rootFolderId=resp["rootFolderId"];colab.drive.userPermissionId=resp["user"]["permissionId"]})});
colab.drive.openDriveViewer=function(){colab.drive.fileDriveUrl.promise.then(function(url){window.open(url)})};
colab.drive.cloneDocument=function(onSuccess,opt_onError){colab.drive.fileId.promise.then(function(fileId){var body={"title":"Copy of "+goog.dom.getElement("doc-name").value,"parents":[{"id":colab.drive.rootFolderId}]};var request=gapi.client.drive.files.copy({"fileId":fileId,"resource":body});request.execute(function(resp){if(resp.error){if(opt_onError)opt_onError(resp);else console.error(resp);return}onSuccess(resp)})})};
colab.drive.uploadToDrive=function(data,metadata,onSuccess,onError,opt_fileId,opt_params){var params=opt_params||{};var delimiter="\r\n--"+colab.drive.MULTIPART_BOUNDARY+"\r\n";var close_delim="\r\n--"+colab.drive.MULTIPART_BOUNDARY+"--";var body=delimiter+"Content-Type: application/json\r\n\r\n"+JSON.stringify(metadata)+delimiter+"Content-Type: "+colab.drive.NOTEBOOK_MIMETYPE+"\r\n"+"\r\n"+data+close_delim;var path="/upload/drive/v2/files";var method="POST";if(opt_fileId){path+="/"+opt_fileId;method=
"PUT"}colab.drive.driveApiReady.then(function(){var request=gapi.client.request({"path":path,"method":method,"params":{"uploadType":"multipart","pinned":params["pinned"]},"headers":{"Content-Type":'multipart/mixed; boundary="'+colab.drive.MULTIPART_BOUNDARY+'"'},"body":body});request.execute(function(response){if(response&&!response.error){var res=(response);var oldTitle=colab.drive.offlineTitle;colab.drive.updateDocumentMetadata(res);if(colab.drive.offlineTitle!=oldTitle){console.log("Updating title due external change: new title ",
colab.drive.offlineTitle,"old title: ",oldTitle);if(!colab.drive.offlineTitleChangePending&&colab.globalRealtimeDoc)colab.drive.setTitle(colab.drive.offlineTitle)}onSuccess((response))}else onError((response||null))})},onError)};
colab.drive.createNewNotebook=function(onSuccess,onError,opt_folderId){var name=colab.drive.NEW_NOTEBOOK_TITLE;var parents=[];if(opt_folderId)parents.push({id:opt_folderId});var data=colab.drive.convertRealtimeToNotebook();var metadata={"parents":parents,"title":name,"description":"IP[y] file","mimeType":colab.drive.NEW_NOTEBOOK_MIMETYPE};colab.drive.uploadToDrive(data,metadata,onSuccess,onError)};
colab.drive.convertFromIpynbFormat=function(json_nb){var multiline_outputs={"text":0,"html":0,"svg":0,"latex":0,"javascript":0,"json":0};var nb=(json_nb);for(var i=0;i<nb.worksheets.length;i++){var ws=nb.worksheets[i];for(var j=0;j<ws["cells"].length;j++){var cell=ws.cells[j];if(cell.cell_type==="code"){if("input"in cell&&Array.isArray(cell.input))cell.input=cell.input.join("");for(var k=0;k<cell.outputs.length;k++){var output=cell.outputs[k];for(var key in multiline_outputs)if(key in output&&Array.isArray(output[key]))output[key]=
output[key].join("")}}else for(var key in{"source":0,"rendered":0})if(key in cell&&Array.isArray(cell[key]))cell[key]=cell[key].join("")}}};
colab.drive.convertNotebookToRealtime=function(fileContents,model){var json=(goog.json.parse(fileContents));var worksheets=json.worksheets;var metadata=json.metadata;colab.drive.convertFromIpynbFormat(json);var cellFromJson=function(json){var cell=model.createMap();if(json["cell_type"]=="code"){cell.set("type","code");cell.set("text",model.createString(json["input"]));cell.set("outputs",model.createList(json["outputs"]))}else{cell.set("type","text");cell.set("text",model.createString(json["source"]))}return cell};
var cells=model.createList();for(var i=0;i<worksheets.length;i++)cells.pushAll(goog.array.map(worksheets[i]["cells"],cellFromJson));metadata=model.createMap();model.getRoot().set("cells",cells);model.getRoot().set("metadata",metadata)};
colab.drive.convertRealtimeToNotebook=function(opt_model){var cellToJson=function(cell){var json={};var type=cell.get("type");if(type==="code"){json["cell_type"]="code";json["input"]=cell.get("text").getText();json["outputs"]=cell.get("outputs").asArray();json["language"]="python"}else{json["cell_type"]="markdown";json["source"]=cell.get("text").getText()}return json};var cells=[];var name=colab.drive.NEW_NOTEBOOK_TITLE;if(opt_model){cells=goog.array.map(opt_model.getRoot().get("cells").asArray(),
cellToJson);name=colab.drive.getTitle(opt_model)}else cells.push({"cell_type":"code","input":"","outputs":[],"language":"python"});var data={"worksheets":[{"cells":cells}],"metadata":{"name":name},"nbformat":3,"nbformat_minor":0};return colab.drive.JSON_FORMATTER_.format(data)};
colab.drive.createModelUUID=function(model,fileId){if(!model.isReadOnly){if(model.getRoot().get("metadata")==null)model.getRoot().set("metadata",model.createMap());var metadata=model.getRoot().get("metadata");if(metadata.get("UUID")==null)metadata.set("UUID",new Date+"");var uuid=metadata.get("UUID");var request=gapi.client.drive.properties.insert({"fileId":fileId,"resource":{"key":"UUID","value":uuid,"visibility":"PUBLIC"}});request.execute(function(response){if(!response||response.error)console.log("Error saving UUID to file")})}};
colab.drive.checkModelUUID=function(model,fileId,onFoundUUIDs,onError){var metadata=model.getRoot().get("metadata");var uuid=metadata&&metadata.get("UUID");if(!uuid){onError("Error getting document UUID");return}var request=gapi.client.drive.properties.get({"fileId":fileId,"propertyKey":"UUID","visibility":"PUBLIC"});request.execute(function(response){if(!response||response.error){onError(response);return}onFoundUUIDs(response.value==uuid)})};
colab.drive.getTitleFromMetadataResponse_=function(response){return response.title||response.originalFilename};
colab.drive.handleReadOnlyDocument=function(fileId,response,error,closure){var new_error=({"message":"This file was not created via coLab. Its"+" metadata needs to be modified for realtime support. <br> <br>"+" Please ask the owner to open this file in "+" colab so it can be set up properly."+" It will remain compatible with ipynb and it will be compatible "+" with readonly viewers. <br/>"+" Alternatively you can clone this file through menu.","original_error":error});colab.drive.offlineTitle=colab.drive.getTitleFromMetadataResponse_(response);
colab.drive.fileDriveUrlIfPresent=response.alternateLink;colab.drive.fileDriveUrl.resolve(response.alternateLink);closure(new_error)};colab.drive.checkIfReadOnly_=function(fileId,error,closure){gapi.client.drive.files.get({"fileId":fileId}).execute(function(response){if(response&&(!response.error&&!response.editable))colab.drive.handleReadOnlyDocument(fileId,response,error,closure);else closure(error)})};colab.drive.documentShared=true;
colab.drive.updateDocumentMetadata=function(resource){colab.drive.fileDriveUrlIfPresent=resource.alternateLink;colab.drive.offlineTitle=colab.drive.getTitleFromMetadataResponse_(resource);colab.drive.documentShared=!(resource.shared==false)};
colab.drive.loadDocument=function(fileId,onLoad,onError,onRealtimeError){var onLoadCallback=function(document){var model=document.getModel();var request=gapi.client.drive.files.get({"fileId":fileId});request.execute(function(response){if(response.error){console.error(response.error);onError(response.error);return}var resource=(response);colab.drive.updateDocumentMetadata(resource);colab.drive.setTitle(colab.drive.offlineTitle,model);colab.drive.fileDriveUrl.resolve(response["alternateLink"]);if(model.getRoot().get("cells")!=
null){colab.drive.createModelUUID(model,fileId);onLoad(document);return}var token=gapi.auth.getToken()["access_token"];var xhrRequest=new XMLHttpRequest;xhrRequest.open("GET",response["downloadUrl"],true);xhrRequest.setRequestHeader("Authorization","Bearer "+token);xhrRequest.onreadystatechange=function(e){if(xhrRequest.readyState==4)if(xhrRequest.status==200){colab.drive.convertNotebookToRealtime(xhrRequest.responseText,model);colab.drive.createModelUUID(model,fileId);onLoad(document)}else{console.error(xhrRequest);
onError(xhrRequest)}};xhrRequest.send()})};var isLoaded=false;colab.drive.driveApiReady.then(function(){gapi.drive.realtime.load(fileId,function(document){isLoaded=true;onLoadCallback(document)},function(){},function(error){if(!isLoaded)colab.drive.checkIfReadOnly_(fileId,error,onError);else onRealtimeError(error)})},function(reason){onError((reason))})};colab.drive.isDirty=false;colab.drive.isClosed=false;
colab.drive.saveDocumentInternal=function(fileId,document,onSave,onError,opt_params){if(!colab.drive.isDirty&&!opt_params){onSave(null);return}var data=colab.drive.convertRealtimeToNotebook(document.getModel());var newTitle=colab.drive.getTitle(document.getModel());colab.drive.offlineTitleChangePending=colab.drive.offlineTitle!=newTitle;var metadata={"title":colab.drive.offlineTitleChangePending?newTitle:undefined,"description":"IP[y] file","mimeType":colab.drive.NEW_NOTEBOOK_MIMETYPE};colab.drive.uploadToDrive(data,
metadata,function(response){colab.drive.isDirty=false;colab.drive.numFailedSaveAttempts=0;onSave(response)},onError,fileId,opt_params)};colab.drive.numFailedSaveAttempts=0;colab.drive.saveDocument=function(document,onSave,onError,opt_params){if(colab.drive.isClosed)onSave(null);var userOnError=onError;onError=function(reason){colab.drive.numFailedSaveAttempts++;userOnError(reason)};colab.drive.fileId.promise.then(function(fileId){colab.drive.saveDocumentInternal(fileId,document,onSave,onError,opt_params)})};
colab.drive.offlineTitle="";colab.drive.getTitle=function(opt_model){var doc=colab.globalRealtimeDoc;if(!doc&&!opt_model)return colab.drive.offlineTitle;var model=opt_model||doc.getModel();var title=model.getRoot().get("title");if(title&&title.getText)var title_text=title.getText();title_text=title_text||colab.drive.offlineTitle;title_text=title_text||colab.drive.NEW_NOTEBOOK_TITLE;return title_text};
colab.drive.onTitleChange=function(handler){if(!colab.globalRealtimeDoc)return;var title=colab.drive.createTitle(colab.globalRealtimeDoc.getModel());if(title&&title.addEventListener)title.addEventListener(gapi.drive.realtime.EventType.OBJECT_CHANGED,function(event){handler(event.target.getText())})};colab.drive.setTitle=function(newTitle,opt_model){var model=opt_model||colab.globalRealtimeDoc.getModel();if(model.isReadOnly)return;var title=colab.drive.createTitle(model);if(!title)return;title.setText(newTitle)};
colab.drive.createTitle=function(model){var title=(model.getRoot().get("title"));if(!title||!title.setText){if(model.isReadOnly)return null;title=model.createString();model.getRoot().set("title",title)}return title};colab.drive.shareClient_;
colab.drive.shareDocument=function(){colab.drive.fileId.promise.then(function(fileId){if(!colab.drive.shareClient_)colab.drive.shareClient_=new gapi.drive.share.ShareClient(colab.APP_ID);var shareClient=colab.drive.shareClient_;shareClient.setItemIds([fileId]);shareClient.showSettingsDialog();colab.drive.validateSharingDialog()})};colab.drive.validationDialogTask=0;
colab.drive.validateSharingDialog=function(){var SHARING_FAILED_CSS_PATH="body > "+'div > div:contains("Sorry, sharing is unavailable")';var count=0;if(colab.drive.validationDialogTask){clearInterval(colab.drive.validationDialogTask);colab.drive.validationDialogTask=0}var fileViewerUrl=colab.drive.fileDriveUrlIfPresent;var failedHtml="Sorry, sharing from the app is unavailable at this time.<br/> <br/>"+"If you are signed in under multiple accounts (eg personal and work), "+"it is likely that you are bitten by a Drive Api bug ("+
'<a href="https://b.corp.google.com/issue?id=13139246">b/13139246</a>).'+"<br/><br/>As a workaround use Drive Viewer ("+'<b><a href="'+fileViewerUrl+'" target=_blank>Click To Open</a></b>)';var check=function(){count+=1;var failed=jQuery(SHARING_FAILED_CSS_PATH);if(failed.size())failed.html(failedHtml);if(count>100){console.log("Sharing validation finished");clearInterval(colab.drive.validationDialogTask)}};colab.drive.validationDialogTask=setInterval(check,300)};
colab.drive.handleRealtimeError=function(error){console.error(error);if(error.isFatal){var reason="The realtime API gave the following error: "+error.message+".  You must reload this document.";colab.onDocumentInvalidation("Fatal Realtime API Error",reason);return}if(error.type===gapi.drive.realtime.ErrorType.TOKEN_REFRESH_REQUIRED){if(colab.app.appMode)return;colab.drive.authorize(function(){},function(reason){colab.onDocumentInvalidation("Failed to get an OAuth token","See console for details.");
console.log(reason)})}};
colab.drive.document=new goog.Promise(function(resolve,reject){var params=colab.params.getHashParams();var load=function(fileId){colab.drive.fileId.resolve(fileId);colab.drive.fileIdIfAvailable=fileId;colab.drive.loadDocument(fileId,function(document){colab.globalRealtimeDoc=document;colab.globalRealtimeDoc.getModel().getRoot().addEventListener(gapi.drive.realtime.EventType.OBJECT_CHANGED,function(event){var root=colab.globalRealtimeDoc.getModel().getRoot();if(event.target==root.get("metadata"))return;
if(!event.isLocal)return;colab.drive.isDirty=true});resolve(document)},reject,colab.drive.handleRealtimeError)};if(params.fileId){console.log("Loading notebook from Google Drive.");load(params.fileId)}else if(params.create){console.log("Creating new notebook in Google Drive.");colab.drive.createNewNotebook(function(response){var fileId=response.id;window.location.hash="#"+colab.params.encodeParamString({fileId:fileId});load(fileId)},reject,params.folderId)}else if(params.fileIds){colab.params.redirectToNotebook({fileId:params.fileIds});
load(params.fileIds)}else if(window.location.search.indexOf("state=")>=0)window.location.pathname="/v2/drive";else window.location.href="/v2/"});
colab.drive.close=function(callback){if(colab.drive.isClosing)return;colab.notification.showPrimary("Closing '"+colab.drive.offlineTitle+"'",-1);colab.drive.isClosing=true;var handler=function(response){if(response&&response.error)console.log(response);if(colab.globalRealtimeDoc)colab.globalRealtimeDoc.close();colab.notification.clearPrimary();colab.drive.isClosed=true;colab.drive.isClosing=false;if(callback)callback()};if(!colab.globalRealtimeDoc||colab.drive.isClosed){handler(null);return}colab.drive.saveDocument(colab.globalRealtimeDoc,
handler,handler)};goog.provide("colab.Presence");goog.require("goog.array");goog.require("goog.dom");colab.updateCollaborators=function(){var collaboratorsDiv=goog.dom.getElement("collaborators");var collaboratorsList=colab.globalRealtimeDoc.getCollaborators();colab.populateCollaboratorsDiv(collaboratorsDiv,collaboratorsList,4)};
colab.createCollaboratorImg_=function(collaborator){var imgSrc=collaborator.photoUrl==null?"img/anon.jpeg":"https:"+collaborator.photoUrl;var isMe=collaborator.isMe&&(collaborator.sessionId===colab.globalMe.sessionId&&collaborator.userId===colab.globalMe.userId);var collaboratorImg=goog.dom.createDom("img",{"class":"collaborator-img","style":"background-color:"+collaborator.color,"src":imgSrc,"title":collaborator.displayName+(isMe?" (Me)":""),"alt":collaborator.displayName});return collaboratorImg};
colab.populateCollaboratorsDiv=function(collaboratorsDiv,collaborators,opt_numShown){var numShown=opt_numShown||2;goog.dom.removeChildren(collaboratorsDiv);var overflowCollaborators=[];goog.array.forEach(collaborators,function(collaborator,index){if(numShown<collaborators.length&&index>=numShown-1)overflowCollaborators.push(collaborator.displayName);else{var collaboratorImg=colab.createCollaboratorImg_(collaborator);goog.dom.appendChild(collaboratorsDiv,collaboratorImg)}});if(overflowCollaborators.length!=
0){var overflowText="+"+(collaborators.length-numShown+1).toString();var overflowDiv=goog.dom.createDom("div",{"class":"collaborator-overflow","title":overflowCollaborators.join("\n")},goog.dom.createDom("span","overflow-text",overflowText));goog.dom.appendChild(collaboratorsDiv,overflowDiv)}};goog.provide("colab.cell.Cell");goog.require("colab.Presence");goog.require("colab.drive.Permissions");goog.require("goog.dom");goog.require("goog.dom.classes");goog.require("goog.events");goog.require("goog.events.EventType");goog.require("goog.ui.Component");goog.require("goog.ui.Container.Orientation");goog.require("goog.ui.MenuItem");goog.require("goog.ui.Toolbar");goog.require("goog.ui.ToolbarButton");goog.require("goog.ui.ToolbarMenuButton");
colab.cell.Cell=function(realtimeCell,permissions){goog.base(this);this.realtimeCell=realtimeCell;this.toolbarDiv=null;this.toolbar=null;this.updating_=false;this.mainContentDiv=null;this.permissions=permissions;colab.cell.Cell.idToCellMap[this.realtimeCell.id]=this};goog.inherits(colab.cell.Cell,goog.ui.Component);colab.cell.Cell.idToCellMap={};
colab.cell.Cell.prototype.scrollIntoView=function(){var bounds=goog.style.getBounds(this.getElement());var topY=bounds.top-window.scrollY;var bottomY=topY+bounds.height;var topHeight=120;var scrollToTop=bounds.top-topHeight;var scrollToBottom=bounds.top-window.innerHeight+bounds.height+10;if(topY<topHeight&&bottomY>window.innerHeight)return;if(topY>topHeight&&bottomY<window.innerHeight)return;if(Math.abs(scrollToTop-window.scrollY)<Math.abs(scrollToBottom-window.scrollY))jQuery("html, body").animate({"scrollTop":scrollToTop});
else jQuery("html, body").animate({"scrollTop":scrollToBottom})};colab.cell.Cell.prototype.isVisible=function(){var bounds=goog.style.getBounds(this.getElement());var topY=bounds.top-window.scrollY;var bottomY=topY+bounds.height;var topHeight=120;if(topY<topHeight&&bottomY<topHeight)return false;if(topY>window.innerHeight&&bottomY>window.innerHeight)return false;return true};
colab.cell.Cell.prototype.createToolbar=function(){this.toolbar=new goog.ui.Toolbar;this.toolbar.setOrientation(goog.ui.Container.Orientation.VERTICAL);var insertMenu=new goog.ui.ToolbarMenuButton("Insert");var addCellInsertMenuItem=goog.bind(function(title,cellType,after){var menuItem=new goog.ui.MenuItem(title);insertMenu.addItem(menuItem);this.getHandler().listenWithScope(menuItem,goog.ui.Component.EventType.ACTION,function(e){var index=colab.globalNotebook.getCellIndex(this.realtimeCell.id);if(after)index++;
colab.globalNotebook.addNewCell(cellType,index)},false,this)},this);addCellInsertMenuItem("Code Above",colab.cell.CellType.CODE,false);addCellInsertMenuItem("Code Below",colab.cell.CellType.CODE,true);addCellInsertMenuItem("Text Above",colab.cell.CellType.TEXT,false);addCellInsertMenuItem("Text Below",colab.cell.CellType.TEXT,true);var events=[goog.ui.Component.EventType.SHOW,goog.ui.Component.EventType.HIDE];goog.events.listen(insertMenu,events,function(e){switch(e.type){case goog.ui.Component.EventType.SHOW:goog.dom.classes.add(this.toolbarDiv,
"cell-toolbar-visible");break;case goog.ui.Component.EventType.HIDE:goog.dom.classes.remove(this.toolbarDiv,"cell-toolbar-visible");break}},false,this);this.toolbar.addChild(insertMenu,true);var deleteButton=new goog.ui.ToolbarButton("Delete");goog.events.listen(deleteButton,goog.ui.Component.EventType.ACTION,function(e){colab.globalNotebook.removeCell(this.realtimeCell)},false,this);this.toolbar.addChild(deleteButton,true)};colab.cell.Cell.prototype.getType=function(){return this.realtimeCell.get("type")};
colab.cell.Cell.SELECTED_CSS_NAME_="selected";
colab.cell.Cell.prototype.setSelected=function(value){if(this.isSelected()==value)return;var collaborators=this.realtimeCell.get("collaborators");var meIndex=goog.array.findIndex(collaborators.asArray(),function(c){return c.sessionId===colab.globalMe.sessionId&&c.userId===colab.globalMe.userId});if(meIndex!=-1)collaborators.remove(meIndex);if(value)collaborators.insert(0,colab.globalMe);goog.dom.classes.enable(this.getElement(),colab.cell.Cell.SELECTED_CSS_NAME_,value)};
colab.cell.Cell.prototype.refresh=function(){var prevScrollY=window.scrollY;goog.style.setElementShown(this.mainContentDiv,false);window["____noop____"]=this.mainContentDiv["offsetHeight"];goog.style.setElementShown(this.mainContentDiv,true);window.scrollTo(window.scrollX,prevScrollY)};colab.cell.Cell.prototype.setDragging=function(value){console.debug(this.realtimeCell.id+(value?": start dragging":": finish dragging"))};
colab.cell.Cell.prototype.isSelected=function(){return goog.dom.classes.has(this.getElement(),colab.cell.Cell.SELECTED_CSS_NAME_)};
colab.cell.Cell.prototype.updateCollaborators_=function(){var globalCollaborators=colab.globalRealtimeDoc.getCollaborators();var collaborators=this.realtimeCell.get("collaborators");goog.array.forEach(collaborators.asArray(),function(collaborator,index){var globalCollaborator=goog.array.find(globalCollaborators,function(c){return c.sessionId===collaborator.sessionId&&c.userId===collaborator.userId});if(!globalCollaborator)collaborators.remove(index)});var collabDiv=this.getElementByClass("cell-collaborators");
colab.populateCollaboratorsDiv(collabDiv,collaborators.asArray(),3);var rightOffset=-4-goog.style.getBounds(collabDiv).width;collabDiv.style.right=rightOffset.toString()+"px"};
colab.cell.Cell.prototype.createDom=function(){var element=goog.dom.createDom("div",{"class":"cell "+this.getType(),"id":this.realtimeCell.id});var cellHandle=goog.dom.createDom("div","cell-handle",[goog.dom.createDom("div","line"),goog.dom.createDom("div","line"),goog.dom.createDom("div","line")]);goog.dom.appendChild(element,cellHandle);var selectionDiv=goog.dom.createDom("div","selection-wrapper");goog.dom.appendChild(element,selectionDiv);this.mainContentDiv=goog.dom.createDom("div","main-content");
goog.dom.appendChild(selectionDiv,this.mainContentDiv);if(this.permissions.isEditable()){this.toolbarDiv=goog.dom.createDom("div","cell-toolbar");goog.dom.appendChild(this.mainContentDiv,this.toolbarDiv)}else goog.dom.classes.add(element,"readonly");goog.dom.appendChild(element,goog.dom.createDom("div","cell-collaborators"));this.setElementInternal(element)};colab.cell.Cell.prototype.selectCellHandler=function(e){if(goog.dom.findCommonAncestor((e.target),this.toolbarDiv)!=this.toolbarDiv)colab.globalNotebook.selectCell(this.realtimeCell.id)};
colab.cell.Cell.prototype.close=function(){var collabList=this.realtimeCell.get("collaborators");goog.array.forEach(collabList.asArray(),function(c,index){if(c.sessionId===colab.globalMe.sessionId&&c.userId===colab.globalMe.userId)collabList.remove(index)})};
colab.cell.Cell.prototype.enterDocument=function(){goog.base(this,"enterDocument");var collabList=this.realtimeCell.get("collaborators");collabList.addEventListener(gapi.drive.realtime.EventType.VALUES_ADDED,goog.bind(this.updateCollaborators_,this));collabList.addEventListener(gapi.drive.realtime.EventType.VALUES_REMOVED,goog.bind(this.updateCollaborators_,this));collabList.addEventListener(gapi.drive.realtime.EventType.VALUES_SET,goog.bind(this.updateCollaborators_,this));if(this.permissions.isEditable()){this.createToolbar();
this.addChild(this.toolbar);this.toolbar.render(this.toolbarDiv);var toolbarDiv=this.toolbarDiv;var handler=this.getHandler();handler.listen(this.toolbarDiv,goog.events.EventType.CLICK,function(e){if(e.target==toolbarDiv){goog.style.setElementShown(e.target,false);var newTarget=document.elementFromPoint(e.clientX,e.clientY);var cellParent=goog.dom.getAncestorByClass(newTarget,"cell");if(cellParent){var event=document.createEvent("UIEvents");event.initUIEvent(goog.events.EventType.CLICK,true,true,
window,1);cellParent.dispatchEvent(event)}goog.style.setStyle(e.target,"display","")}},false);handler.listen(this.getElement(),goog.events.EventType.CLICK,goog.bind(this.selectCellHandler,this),false)}};goog.provide("colab.dialog");goog.require("goog.ui.Dialog");
colab.dialog.displayError=function(text,reason){var dialog=new goog.ui.Dialog;var message="";if(reason)if(reason.message)message="<br/> <b> Error: </b> "+reason.message;else if(reason.error)message="<br/> <b> Error: </b> "+reason.error.message;dialog.setContent(text+message+"<br/> See console for more details.");dialog.setTitle("Error");dialog.setButtonSet(goog.ui.Dialog.ButtonSet.createOk());console.log("Reason: ",reason);dialog.setDisposeOnHide(true);dialog.setVisible(true)};
colab.dialog.displayErrorHandler=function(text){return goog.partial(colab.dialog.displayError,text)};goog.provide("colab.filepicker");colab.filepicker.PUBLIC_DEVELOPER_KEY="AIzaSyCoDfWuxLxqqLWfKVNqfHy7DIWudoPTeuk";
colab.filepicker.selectFile=function(cb){gapi.load("picker",function(){var view=new google.picker.DocsView;view.setMode(google.picker.DocsViewMode.LIST);view.setQuery("ipynb");view.setIncludeFolders(true).setSelectFolderEnabled(false);view.setLabel("Everything");var samples=new google.picker.DocsView;samples.setMode(google.picker.DocsViewMode.LIST);samples.setParent("0B0T--Ij9EBKoY3J0Ri05cTZxRG8");samples.setLabel("Sample Notebooks");var byMe=new google.picker.DocsView;byMe.setOwnedByMe(true);byMe.setMode(google.picker.DocsViewMode.LIST);
byMe.setIncludeFolders(true).setSelectFolderEnabled(false);var mimeTypes="application/ipynb"+",application/colab,application/ipy,"+"application/octet-stream,application/vnd";var recentlyPicked=new google.picker.View(google.picker.ViewId.RECENTLY_PICKED);recentlyPicked.setMimeTypes(mimeTypes);var upload=new google.picker.DocsUploadView;var picker=(new google.picker.PickerBuilder).addView(recentlyPicked).addView(view).addView(byMe).addView(samples).addView(upload).setOAuthToken(gapi.auth.getToken().access_token).setDeveloperKey(colab.filepicker.PUBLIC_DEVELOPER_KEY).setSelectableMimeTypes(mimeTypes).setCallback(cb);
var dlg=picker.build();dlg.setVisible(true)})};colab.filepicker.selectDir=function(cb){gapi.load("picker",function(){var docsView=(new google.picker.DocsView).setIncludeFolders(true).setMimeTypes("application/vnd.google-apps.folder").setSelectFolderEnabled(true);var picker=(new google.picker.PickerBuilder).setOAuthToken(gapi.auth.getToken().access_token).setDeveloperKey(colab.filepicker.PUBLIC_DEVELOPER_KEY).addView(docsView).setCallback(cb);var dlg=picker.build();dlg.setVisible(true)})};
colab.filepicker.selectFileAndReload=function(){var cb=function(ev){var response=google.picker.Response;if(ev[response.ACTION]!=google.picker.Action.PICKED)return;var doc=ev[response.DOCUMENTS][0];if(!doc||doc.length)return;var fileId=doc[google.picker.Document.ID];var url=colab.params.getNotebookUrl({"fileId":fileId});if(colab.reload){window.location.href=url;colab.reload()}else window.location.href=url};colab.filepicker.selectFile(cb)};goog.provide("colab.Notification");goog.provide("colab.notification");goog.require("goog.dom");goog.require("goog.dom.classes");colab.notification.count_=0;colab.notification.showNotification=function(msg,opt_class,opt_timeout){return new colab.Notification(msg,opt_class,opt_timeout)};colab.notification.clearPrimary=function(){if(colab.notification.primary)colab.notification.primary.clear()};colab.notification.showPrimary=function(msg,opt_timeout){colab.notification.primary.change(msg,opt_timeout)};
colab.Notification=function(msg,opt_class,opt_timeout,opt_hide){this.timer=0;this.class_=opt_class;if(!opt_hide)this.change(msg,opt_timeout)};
colab.Notification.prototype.change=function(msg,opt_timeout){if(!this.el_){var root=goog.dom.getElement("message-area");this.el_=goog.dom.createDom("span","notification");if(this.class_)goog.dom.classes.add(this.el_,this.class_);goog.style.setElementShown(this.el_,false);root.appendChild(this.el_)}jQuery(this.el_).stop().fadeIn();if(this.timer)clearTimeout(this.timer);var timeout=opt_timeout||3E3;this.el_.innerHTML=msg;var that=this;if(timeout>=0)this.timer=setTimeout(function(){that.clear()},timeout)};
colab.Notification.prototype.clear=function(){if(this.el_){var n=this;jQuery(this.el_).stop().fadeOut(400,function(){goog.dom.getElement("message-area").removeChild(n.el_);n.el_=null})}};colab.notification.createEmptyNotification=function(opt_class){return new colab.Notification("",opt_class,undefined,true)};colab.notification.primary=colab.notification.createEmptyNotification();goog.provide("colab.Header");goog.require("colab.dialog");goog.require("colab.filepicker");goog.require("colab.notification");goog.require("goog.Promise");goog.require("goog.dom");goog.require("goog.dom.classes");goog.require("goog.events");goog.require("goog.ui.Menu");goog.require("goog.ui.MenuBarRenderer");goog.require("goog.ui.MenuItem");goog.require("goog.ui.Option");goog.require("goog.ui.SelectionModel");goog.require("goog.ui.Separator");goog.require("goog.ui.Toolbar");goog.require("goog.ui.ToolbarButton");
goog.require("goog.ui.ToolbarMenuButton");goog.require("goog.ui.ToolbarRenderer");goog.require("goog.ui.ToolbarSelect");goog.require("goog.ui.ToolbarSeparator");goog.require("goog.ui.ToolbarToggleButton");goog.require("goog.ui.menuBar");goog.require("goog.ui.menuBarDecorator");goog.require("userfeedback.api");
colab.setupHeader=function(document,permissions){colab.initDocumentNameInput(permissions);colab.createMenubar(document,permissions);if(permissions)colab.createToolbar(permissions);if(document){var shareButton=goog.dom.getElement("share");goog.style.setElementShown(shareButton,true);shareButton.onclick=function(){colab.drive.shareDocument()};var commentsButton=goog.dom.getElement("comments");goog.style.setElementShown(commentsButton,true)}};
colab.createMenubar=function(document,permissions){var menubarElement=goog.dom.getElement("top-menubar");goog.style.setElementShown(menubarElement,true);var menubar=goog.ui.decorate(menubarElement);if(!document||permissions&&!permissions.isEditable()){menubar.getChild("edit-menu-button").setEnabled(false);menubar.getChild("run-menu-button").setEnabled(false);menubar.getChild("backend-menu-button").setEnabled(false);var fileMenu=menubar.getChild("file-button").getMenu();fileMenu.getChild("download-ipynb-menuitem").setEnabled(!!document);
fileMenu.getChild("save-menuitem").setEnabled(false)}goog.events.listen(menubar,goog.ui.Component.EventType.ACTION,function(e){switch(e.target.getId()){case "save-menuitem":var n=colab.notification.showNotification("Saving...","",-1);colab.drive.saveDocument(colab.globalRealtimeDoc,function(){n.change("Saved successfully!",5E3)},function(err){n.clear();colab.dialog.displayError("Failed to save",err)},{"pinned":true});return;case "share-menuitem":colab.drive.shareDocument();break;case "clone-menuitem":colab.close(function(){colab.notification.showPrimary("Creating a copy...",
-1);colab.drive.cloneDocument(function(response){colab.notification.showPrimary("Done");window.location.hash=colab.params.existingNotebookHash(response.id);window.location.reload()},function(response){colab.notification.clearPrimary();colab.dialog.displayError("Unable to clone notebook",response)})});break;case "new-menuitem":window.location.hash=colab.params.newNotebookHash();colab.reload();break;case "open-menuitem":colab.filepicker.selectFileAndReload();break;case "viewindrive-menuitem":colab.drive.openDriveViewer();
break;case "clear-outputs-menuitem":colab.globalNotebook.clearOutputs();break;case "clear-notebook-menuitem":colab.globalNotebook.clear();break;case "undo-menuitem":colab.globalNotebook.undo();break;case "redo-menuitem":colab.globalNotebook.redo();break;case "runall-menuitem":colab.globalNotebook.runAll();break;case "runbefore-menuitem":colab.globalNotebook.runBefore();break;case "runafter-menuitem":colab.globalNotebook.runAfter();break;case "download-ipynb-menuitem":var a=goog.dom.createElement("a");
var name=goog.dom.getElement("doc-name").value;var data=colab.drive.convertRealtimeToNotebook(colab.globalRealtimeDoc.getModel());a.href=window.URL.createObjectURL(new Blob([data]));var filename=goog.dom.getElement("doc-name").value.split(".")[0];a.download=filename+".ipynb";a.click();break;case "restart-menuitem":colab.globalKernel.restart();break;case "kill-menuitem":colab.globalKernel.kill();break;case "interrupt-menuitem":colab.globalKernel.interrupt();break;case "connect-menuitem":colab.openKernelDialogBox();
break;case "report-bug-menuitem":window.open("https://b.corp.google.com/createIssue?component=102164","Colab Bugs");break;case "send-feedback-menuitem":userfeedback.api.startFeedback({productId:101049});break;default:console.error("Unknown menu item "+e.target.getContent())}})};
colab.createToolbar=function(permissions){if(!permissions.isEditable())return;var toolbarElement=goog.dom.getElement("top-toolbar");goog.style.setElementShown(toolbarElement,true);var toolbar=new goog.ui.Toolbar;toolbar.decorate(toolbarElement);goog.events.listen(toolbar,goog.ui.Component.EventType.ACTION,function(e){switch(e.target.getId()){case "add-code-toolbar-button":colab.globalNotebook.addNewCell(colab.cell.CellType.CODE);break;case "add-text-toolbar-button":colab.globalNotebook.addNewCell(colab.cell.CellType.TEXT);
break;case "cell-up-toolbar-button":colab.globalNotebook.moveCellUp();break;case "cell-down-toolbar-button":colab.globalNotebook.moveCellDown();break;case "backend-connect-toolbar-button":colab.openKernelDialogBox();break;default:console.log(e.target.getContent())}});jQuery([IPython.events]).on("websocket_open.Kernel",function(){jQuery("#backend-connect-toolbar-button").children().children().text("Connected");goog.dom.classes.addRemove(goog.dom.getElement("backend-connect-toolbar-button"),["connecting",
"disconnected"],"connected")});jQuery([IPython.events]).on("websocket_closed.Kernel",function(){jQuery("#backend-connect-toolbar-button").children().children().text("Connect to Python");goog.dom.classes.addRemove(goog.dom.getElement("backend-connect-toolbar-button"),["connected","connecting"],"disconnected")});jQuery([IPython.events]).on("start_failed.Kernel",function(ev,data){jQuery("#backend-connect-toolbar-button").children().children().text("Connect to Python");goog.dom.classes.addRemove(goog.dom.getElement("backend-connect-toolbar-button"),
["connected","connecting"],"disconnected")});jQuery([IPython.events]).on("starting.Kernel",function(ev,data){jQuery("#backend-connect-toolbar-button").children().children().text("Connecting");goog.dom.classes.addRemove(goog.dom.getElement("backend-connect-toolbar-button"),["connected","disconnected"],"connecting")});jQuery([IPython.events]).on("pnacl_loadend.Kernel",function(ev,data){jQuery("#backend-connect-toolbar-button").children().children().text("PNaCl Initializing");goog.dom.classes.addRemove(goog.dom.getElement("backend-connect-toolbar-button"),
["connected","disconnected"],"connecting")})};colab.initDocumentNameInput=function(permissions){var element=goog.dom.getElement("doc-name");if(permissions&&permissions.isEditable()){element.disabled=false;var setRemote=function(){colab.drive.setTitle(element.value)};element.onkeyup=setRemote;element.onchange=setRemote}else element.disabled=true;var title=colab.drive.getTitle();var setLocal=function(title){document.title=title;if(element.value!=title)element.value=title};setLocal(title);colab.drive.onTitleChange(setLocal)};goog.provide("goog.fx.DragListDirection");goog.provide("goog.fx.DragListGroup");goog.provide("goog.fx.DragListGroup.EventType");goog.provide("goog.fx.DragListGroupEvent");goog.require("goog.array");goog.require("goog.asserts");goog.require("goog.dom");goog.require("goog.dom.classlist");goog.require("goog.events");goog.require("goog.events.Event");goog.require("goog.events.EventHandler");goog.require("goog.events.EventTarget");goog.require("goog.events.EventType");goog.require("goog.fx.Dragger");goog.require("goog.math.Coordinate");
goog.require("goog.string");goog.require("goog.style");goog.fx.DragListGroup=function(){goog.events.EventTarget.call(this);this.dragLists_=[];this.dragItems_=[];this.dragItemForHandle_={};this.eventHandler_=new goog.events.EventHandler(this);this.isInitialized_=false;this.isCurrDragItemAlwaysDisplayed_=false;this.updateWhileDragging_=true};goog.inherits(goog.fx.DragListGroup,goog.events.EventTarget);goog.fx.DragListDirection={DOWN:0,RIGHT:2,LEFT:3,RIGHT_2D:4,LEFT_2D:5};
goog.fx.DragListGroup.EventType={BEFOREDRAGSTART:"beforedragstart",DRAGSTART:"dragstart",BEFOREDRAGMOVE:"beforedragmove",DRAGMOVE:"dragmove",BEFOREDRAGEND:"beforedragend",DRAGEND:"dragend"};goog.fx.DragListGroup.prototype.dragItemHoverClasses_;goog.fx.DragListGroup.prototype.dragItemHandleHoverClasses_;goog.fx.DragListGroup.prototype.currDragItemClasses_;goog.fx.DragListGroup.prototype.draggerElClasses_;goog.fx.DragListGroup.prototype.currDragItem_;goog.fx.DragListGroup.prototype.currHoverList_;goog.fx.DragListGroup.prototype.origList_;
goog.fx.DragListGroup.prototype.origNextItem_;goog.fx.DragListGroup.prototype.currHoverItem_;goog.fx.DragListGroup.prototype.draggerEl_;goog.fx.DragListGroup.prototype.dragger_;goog.fx.DragListGroup.prototype.hysteresisDistance_=0;goog.fx.DragListGroup.prototype.setIsCurrDragItemAlwaysDisplayed=function(){this.isCurrDragItemAlwaysDisplayed_=true};goog.fx.DragListGroup.prototype.setNoUpdateWhileDragging=function(){this.updateWhileDragging_=false};
goog.fx.DragListGroup.prototype.setHysteresis=function(distance){this.hysteresisDistance_=distance};goog.fx.DragListGroup.prototype.getHysteresis=function(){return this.hysteresisDistance_};goog.fx.DragListGroup.prototype.addDragList=function(dragListElement,growthDirection,opt_unused,opt_dragHoverClass){goog.asserts.assert(!this.isInitialized_);dragListElement.dlgGrowthDirection_=growthDirection;dragListElement.dlgDragHoverClass_=opt_dragHoverClass;this.dragLists_.push(dragListElement)};
goog.fx.DragListGroup.prototype.setFunctionToGetHandleForDragItem=function(getHandleForDragItemFn){goog.asserts.assert(!this.isInitialized_);this.getHandleForDragItem_=getHandleForDragItemFn};goog.fx.DragListGroup.prototype.setDragItemHoverClass=function(var_args){goog.asserts.assert(!this.isInitialized_);this.dragItemHoverClasses_=goog.array.slice(arguments,0)};
goog.fx.DragListGroup.prototype.setDragItemHandleHoverClass=function(var_args){goog.asserts.assert(!this.isInitialized_);this.dragItemHandleHoverClasses_=goog.array.slice(arguments,0)};goog.fx.DragListGroup.prototype.setCurrDragItemClass=function(var_args){goog.asserts.assert(!this.isInitialized_);this.currDragItemClasses_=goog.array.slice(arguments,0)};goog.fx.DragListGroup.prototype.setDraggerElClass=function(draggerElClass){goog.asserts.assert(!this.isInitialized_);this.draggerElClasses_=goog.string.trim(draggerElClass).split(" ")};
goog.fx.DragListGroup.prototype.init=function(){if(this.isInitialized_)return;for(var i=0,numLists=this.dragLists_.length;i<numLists;i++){var dragList=this.dragLists_[i];var dragItems=goog.dom.getChildren(dragList);for(var j=0,numItems=dragItems.length;j<numItems;++j)this.listenForDragEvents(dragItems[j])}this.isInitialized_=true};
goog.fx.DragListGroup.prototype.addItemToDragList=function(list,item,opt_index){if(goog.isDef(opt_index))goog.dom.insertChildAt(list,item,opt_index);else goog.dom.appendChild(list,item);this.listenForDragEvents(item)};
goog.fx.DragListGroup.prototype.disposeInternal=function(){this.eventHandler_.dispose();for(var i=0,n=this.dragLists_.length;i<n;i++){var dragList=this.dragLists_[i];dragList.dlgGrowthDirection_=undefined;dragList.dlgDragHoverClass_=undefined}this.dragLists_.length=0;this.dragItems_.length=0;this.dragItemForHandle_=null;this.cleanupDragDom_();goog.fx.DragListGroup.superClass_.disposeInternal.call(this)};
goog.fx.DragListGroup.prototype.recacheListAndItemBounds_=function(currDragItem){for(var i=0,n=this.dragLists_.length;i<n;i++){var dragList=this.dragLists_[i];dragList.dlgBounds_=goog.style.getBounds(dragList)}for(var i=0,n=this.dragItems_.length;i<n;i++){var dragItem=this.dragItems_[i];if(dragItem!=currDragItem)dragItem.dlgBounds_=goog.style.getBounds(dragItem)}};
goog.fx.DragListGroup.prototype.listenForDragEvents=function(dragItem){var dragItemHandle=this.getHandleForDragItem_(dragItem);var uid=goog.getUid(dragItemHandle);this.dragItemForHandle_[uid]=dragItem;if(this.dragItemHoverClasses_){this.eventHandler_.listen(dragItem,goog.events.EventType.MOUSEOVER,this.handleDragItemMouseover_);this.eventHandler_.listen(dragItem,goog.events.EventType.MOUSEOUT,this.handleDragItemMouseout_)}if(this.dragItemHandleHoverClasses_){this.eventHandler_.listen(dragItemHandle,
goog.events.EventType.MOUSEOVER,this.handleDragItemHandleMouseover_);this.eventHandler_.listen(dragItemHandle,goog.events.EventType.MOUSEOUT,this.handleDragItemHandleMouseout_)}this.dragItems_.push(dragItem);this.eventHandler_.listen(dragItemHandle,[goog.events.EventType.MOUSEDOWN,goog.events.EventType.TOUCHSTART],this.handlePotentialDragStart_)};
goog.fx.DragListGroup.prototype.handlePotentialDragStart_=function(e){var uid=goog.getUid((e.currentTarget));this.currDragItem_=(this.dragItemForHandle_[uid]);this.draggerEl_=this.createDragElementInternal(this.currDragItem_);if(this.draggerElClasses_)goog.dom.classlist.addAll(goog.asserts.assert(this.draggerEl_),this.draggerElClasses_||[]);this.draggerEl_.style.margin="0";this.draggerEl_.style.position="absolute";this.draggerEl_.style.visibility="hidden";var doc=goog.dom.getOwnerDocument(this.currDragItem_);
doc.body.appendChild(this.draggerEl_);var currDragItemPos=goog.style.getPageOffset(this.currDragItem_);goog.style.setPageOffset(this.draggerEl_,currDragItemPos);this.dragger_=new goog.fx.Dragger(this.draggerEl_);this.dragger_.setHysteresis(this.hysteresisDistance_);goog.events.listen(this.dragger_,goog.fx.Dragger.EventType.START,this.handleDragStart_,false,this);goog.events.listen(this.dragger_,goog.fx.Dragger.EventType.END,this.handleDragEnd_,false,this);goog.events.listen(this.dragger_,goog.fx.Dragger.EventType.EARLY_CANCEL,
this.cleanup_,false,this);this.dragger_.startDrag(e)};goog.fx.DragListGroup.prototype.cloneNode_=function(sourceEl){return goog.fx.Dragger.cloneNode(sourceEl)};goog.fx.DragListGroup.prototype.createDragElementInternal=function(sourceEl){return this.cloneNode_(sourceEl)};
goog.fx.DragListGroup.prototype.handleDragStart_=function(e){if(!this.dispatchEvent(new goog.fx.DragListGroupEvent(goog.fx.DragListGroup.EventType.BEFOREDRAGSTART,this,e.browserEvent,this.currDragItem_,null,null))){e.preventDefault();this.cleanup_();return}this.origList_=(this.currDragItem_.parentNode);this.origNextItem_=goog.dom.getNextElementSibling(this.currDragItem_);this.currHoverItem_=this.origNextItem_;this.currHoverList_=this.origList_;if(this.currDragItemClasses_)goog.dom.classlist.addAll(goog.asserts.assert(this.currDragItem_),
this.currDragItemClasses_||[]);else this.currDragItem_.style.visibility="hidden";var draggerElSize=goog.style.getSize(this.draggerEl_);this.draggerEl_.halfWidth=draggerElSize.width/2;this.draggerEl_.halfHeight=draggerElSize.height/2;this.draggerEl_.style.visibility="";if(this.updateWhileDragging_)this.currDragItem_.style.display="none";this.recacheListAndItemBounds_(this.currDragItem_);this.currDragItem_.style.display="";goog.events.listen(this.dragger_,goog.fx.Dragger.EventType.DRAG,this.handleDragMove_,
false,this);this.dispatchEvent(new goog.fx.DragListGroupEvent(goog.fx.DragListGroup.EventType.DRAGSTART,this,e.browserEvent,this.currDragItem_,this.draggerEl_,this.dragger_))};
goog.fx.DragListGroup.prototype.handleDragMove_=function(dragEvent){var draggerElPos=goog.style.getPageOffset(this.draggerEl_);var draggerElCenter=new goog.math.Coordinate(draggerElPos.x+this.draggerEl_.halfWidth,draggerElPos.y+this.draggerEl_.halfHeight);var hoverList=this.getHoverDragList_(draggerElCenter);var hoverNextItem=hoverList?this.getHoverNextItem_(hoverList,draggerElCenter):null;var rv=this.dispatchEvent(new goog.fx.DragListGroupEvent(goog.fx.DragListGroup.EventType.BEFOREDRAGMOVE,this,
dragEvent,this.currDragItem_,this.draggerEl_,this.dragger_,draggerElCenter,hoverList,hoverNextItem));if(!rv)return false;if(hoverList){if(this.updateWhileDragging_)this.insertCurrDragItem_(hoverList,hoverNextItem);else this.updateCurrHoverItem(hoverNextItem,draggerElCenter);this.currDragItem_.style.display="";if(hoverList.dlgDragHoverClass_)goog.dom.classlist.add(goog.asserts.assert(hoverList),hoverList.dlgDragHoverClass_)}else{if(!this.isCurrDragItemAlwaysDisplayed_)this.currDragItem_.style.display=
"none";for(var i=0,n=this.dragLists_.length;i<n;i++){var dragList=this.dragLists_[i];if(dragList.dlgDragHoverClass_)goog.dom.classlist.remove(goog.asserts.assert(dragList),dragList.dlgDragHoverClass_)}}if(hoverList!=this.currHoverList_){this.currHoverList_=hoverList;this.recacheListAndItemBounds_(this.currDragItem_)}this.dispatchEvent(new goog.fx.DragListGroupEvent(goog.fx.DragListGroup.EventType.DRAGMOVE,this,dragEvent,(this.currDragItem_),this.draggerEl_,this.dragger_,draggerElCenter,hoverList,
hoverNextItem));return false};goog.fx.DragListGroup.prototype.cleanup_=function(opt_e){this.cleanupDragDom_();this.currDragItem_=null;this.currHoverList_=null;this.origList_=null;this.origNextItem_=null;this.draggerEl_=null;this.dragger_=null;for(var i=0,n=this.dragLists_.length;i<n;i++)this.dragLists_[i].dlgBounds_=null;for(var i=0,n=this.dragItems_.length;i<n;i++)this.dragItems_[i].dlgBounds_=null};
goog.fx.DragListGroup.prototype.handleDragEnd_=function(dragEvent){var rv=this.dispatchEvent(new goog.fx.DragListGroupEvent(goog.fx.DragListGroup.EventType.BEFOREDRAGEND,this,dragEvent,(this.currDragItem_),this.draggerEl_,this.dragger_));if(!rv)return false;if(!this.updateWhileDragging_)this.insertCurrHoverItem();this.cleanupDragDom_();this.dispatchEvent(new goog.fx.DragListGroupEvent(goog.fx.DragListGroup.EventType.DRAGEND,this,dragEvent,this.currDragItem_,this.draggerEl_,this.dragger_));this.cleanup_();
return true};
goog.fx.DragListGroup.prototype.cleanupDragDom_=function(){goog.dispose(this.dragger_);if(this.draggerEl_)goog.dom.removeNode(this.draggerEl_);if(this.currDragItem_&&this.currDragItem_.style.display=="none"){this.origList_.insertBefore(this.currDragItem_,this.origNextItem_);this.currDragItem_.style.display=""}if(this.currDragItemClasses_&&this.currDragItem_)goog.dom.classlist.removeAll(goog.asserts.assert(this.currDragItem_),this.currDragItemClasses_||[]);else if(this.currDragItem_)this.currDragItem_.style.visibility="visible";
for(var i=0,n=this.dragLists_.length;i<n;i++){var dragList=this.dragLists_[i];if(dragList.dlgDragHoverClass_)goog.dom.classlist.remove(goog.asserts.assert(dragList),dragList.dlgDragHoverClass_)}};goog.fx.DragListGroup.prototype.getHandleForDragItem_=function(dragItem){return dragItem};goog.fx.DragListGroup.prototype.handleDragItemMouseover_=function(e){var targetEl=goog.asserts.assertElement(e.currentTarget);goog.dom.classlist.addAll(targetEl,this.dragItemHoverClasses_||[])};
goog.fx.DragListGroup.prototype.handleDragItemMouseout_=function(e){var targetEl=goog.asserts.assertElement(e.currentTarget);goog.dom.classlist.removeAll(targetEl,this.dragItemHoverClasses_||[])};goog.fx.DragListGroup.prototype.handleDragItemHandleMouseover_=function(e){var targetEl=goog.asserts.assertElement(e.currentTarget);goog.dom.classlist.addAll(targetEl,this.dragItemHandleHoverClasses_||[])};
goog.fx.DragListGroup.prototype.handleDragItemHandleMouseout_=function(e){var targetEl=goog.asserts.assertElement(e.currentTarget);goog.dom.classlist.removeAll(targetEl,this.dragItemHandleHoverClasses_||[])};
goog.fx.DragListGroup.prototype.getHoverDragList_=function(draggerElCenter){var prevHoverList=null;if(this.currDragItem_.style.display!="none"){prevHoverList=(this.currDragItem_.parentNode);var prevHoverListBounds=goog.style.getBounds(prevHoverList);if(this.isInRect_(draggerElCenter,prevHoverListBounds))return prevHoverList}for(var i=0,n=this.dragLists_.length;i<n;i++){var dragList=this.dragLists_[i];if(dragList==prevHoverList)continue;if(this.isInRect_(draggerElCenter,dragList.dlgBounds_))return dragList}return null};
goog.fx.DragListGroup.prototype.isInRect_=function(pos,rect){return pos.x>rect.left&&(pos.x<rect.left+rect.width&&(pos.y>rect.top&&pos.y<rect.top+rect.height))};goog.fx.DragListGroup.prototype.updateCurrHoverItem=function(hoverNextItem,opt_draggerElCenter){if(hoverNextItem)this.currHoverItem_=hoverNextItem};goog.fx.DragListGroup.prototype.insertCurrHoverItem=function(){this.origList_.insertBefore(this.currDragItem_,this.currHoverItem_)};
goog.fx.DragListGroup.prototype.getHoverNextItem_=function(hoverList,draggerElCenter){if(hoverList==null)throw Error("getHoverNextItem_ called with null hoverList.");var relevantCoord;var getRelevantBoundFn;var isBeforeFn;var pickClosestRow=false;var distanceToClosestRow=undefined;switch(hoverList.dlgGrowthDirection_){case goog.fx.DragListDirection.DOWN:relevantCoord=draggerElCenter.y;getRelevantBoundFn=goog.fx.DragListGroup.getBottomBound_;isBeforeFn=goog.fx.DragListGroup.isLessThan_;break;case goog.fx.DragListDirection.RIGHT_2D:pickClosestRow=
true;case goog.fx.DragListDirection.RIGHT:relevantCoord=draggerElCenter.x;getRelevantBoundFn=goog.fx.DragListGroup.getRightBound_;isBeforeFn=goog.fx.DragListGroup.isLessThan_;break;case goog.fx.DragListDirection.LEFT_2D:pickClosestRow=true;case goog.fx.DragListDirection.LEFT:relevantCoord=draggerElCenter.x;getRelevantBoundFn=goog.fx.DragListGroup.getLeftBound_;isBeforeFn=goog.fx.DragListGroup.isGreaterThan_;break}var earliestAfterItem=null;var earliestAfterItemRelevantBound;var hoverListItems=goog.dom.getChildren(hoverList);
for(var i=0,n=hoverListItems.length;i<n;i++){var item=hoverListItems[i];if(item==this.currDragItem_)continue;var relevantBound=getRelevantBoundFn(item.dlgBounds_);if(pickClosestRow){var distanceToRow=goog.fx.DragListGroup.verticalDistanceFromItem_(item,draggerElCenter);if(!goog.isDef(distanceToClosestRow))distanceToClosestRow=distanceToRow;if(isBeforeFn(relevantCoord,relevantBound)&&(earliestAfterItemRelevantBound==undefined||(distanceToRow<distanceToClosestRow||distanceToRow==distanceToClosestRow&&
(isBeforeFn(relevantBound,earliestAfterItemRelevantBound)||relevantBound==earliestAfterItemRelevantBound)))){earliestAfterItem=item;earliestAfterItemRelevantBound=relevantBound}if(distanceToRow<distanceToClosestRow)distanceToClosestRow=distanceToRow}else if(isBeforeFn(relevantCoord,relevantBound)&&(earliestAfterItemRelevantBound==undefined||isBeforeFn(relevantBound,earliestAfterItemRelevantBound))){earliestAfterItem=item;earliestAfterItemRelevantBound=relevantBound}}if(!goog.isNull(earliestAfterItem)&&
goog.fx.DragListGroup.verticalDistanceFromItem_(earliestAfterItem,draggerElCenter)>distanceToClosestRow)return null;else return earliestAfterItem};goog.fx.DragListGroup.verticalDistanceFromItem_=function(item,target){var itemBounds=item.dlgBounds_;var itemCenterY=itemBounds.top+(itemBounds.height-1)/2;return Math.abs(target.y-itemCenterY)};goog.fx.DragListGroup.getBottomBound_=function(itemBounds){return itemBounds.top+itemBounds.height-1};
goog.fx.DragListGroup.getRightBound_=function(itemBounds){return itemBounds.left+itemBounds.width-1};goog.fx.DragListGroup.getLeftBound_=function(itemBounds){return itemBounds.left||0};goog.fx.DragListGroup.isLessThan_=function(a,b){return a<b};goog.fx.DragListGroup.isGreaterThan_=function(a,b){return a>b};
goog.fx.DragListGroup.prototype.insertCurrDragItem_=function(hoverList,hoverNextItem){if(this.currDragItem_.parentNode!=hoverList||goog.dom.getNextElementSibling(this.currDragItem_)!=hoverNextItem)hoverList.insertBefore(this.currDragItem_,hoverNextItem)};
goog.fx.DragListGroupEvent=function(type,dragListGroup,event,currDragItem,draggerEl,dragger,opt_draggerElCenter,opt_hoverList,opt_hoverNextItem){goog.events.Event.call(this,type);this.dragListGroup=dragListGroup;this.event=event;this.currDragItem=currDragItem;this.draggerEl=draggerEl;this.dragger=dragger;this.draggerElCenter=opt_draggerElCenter;this.hoverList=opt_hoverList;this.hoverNextItem=opt_hoverNextItem};goog.inherits(goog.fx.DragListGroupEvent,goog.events.Event);goog.provide("colab.services");colab.services.REQUEST_TYPE_KEY="colabtools_input_request_type";colab.services.REQUEST_JSON_KEY="colabtools_request_json";colab.services.kernelRequestCallbacks_={};colab.services.setKernelRequestListener=function(requestType,callback){colab.services.kernelRequestCallbacks_[requestType]=callback};
colab.services.handleKernelRequest=function(request){var requestType=request[colab.services.REQUEST_TYPE_KEY];var requestContent=JSON.parse(request[colab.services.REQUEST_JSON_KEY]);var listener=colab.services.kernelRequestCallbacks_[requestType];if(!listener){var err={"type":"NO_HANDLER_ERROR","description":"No handler was provided for the given request type"};colab.globalKernel.send_input_reply(({"error":err}));return}listener(requestContent,goog.bind(colab.globalKernel.send_input_reply,colab.globalKernel))};goog.provide("colab.cell.ComboBoxFormWidget");goog.provide("colab.cell.FormView");goog.provide("colab.cell.SliderFormWidget");goog.provide("colab.cell.TextFieldFormWidget");goog.require("goog.array");goog.require("goog.dom");goog.require("goog.dom.classes");goog.require("goog.ui.ComboBox");goog.require("goog.ui.Component");goog.require("goog.ui.MenuItem");goog.require("goog.ui.Select");goog.require("goog.ui.Slider");colab.cell.FormView=function(callback){goog.base(this);this.callback_=callback};
goog.inherits(colab.cell.FormView,goog.ui.Component);colab.cell.FormView.prototype.createDom=function(){this.setElementInternal(goog.dom.createDom("div","formview"))};colab.cell.FormView.prototype.setExpanded=function(value){if(value)goog.dom.classes.add(this.getElement(),"formview-full");else goog.dom.classes.remove(this.getElement(),"formview-full")};colab.cell.FormView.prototype.show=function(value){goog.style.setElementShown(this.getElement(),value)};
colab.cell.FormView.WidgetType={TEXT:"text",COMBOBOX:"combo",SLIDER:"slider"};colab.cell.FormView.prototype.parseCode=function(code){goog.array.forEach(this.removeChildren(true),function(child){child.dispose()});var lines=code.split(/[\r\n]+/);goog.array.forEach(lines,function(line){var formWidget=this.parseLine_(line);if(formWidget!=null)this.addChild(formWidget,true)},this)};
colab.cell.FormView.prototype.parseParams_=function(paramsString){try{return(JSON.parse(paramsString.replace(/([\S]+)\:/g,'"$1":').replace(/'/g,'"')))}catch(e){return null}};
colab.cell.FormView.prototype.parseLine_=function(line){var matches=/(\w+)\s*=(.*)#\s*@param(.*)/.exec(line);if(!matches)return null;var name=matches[1];var value=matches[2].trim();var params=null;params=this.parseParams_(matches[3]);if(goog.isArray(params)){var domain=params;params={};params["type"]=colab.cell.FormView.WidgetType.COMBOBOX;params["domain"]=domain}else if(!params||!params["type"])params={"type":colab.cell.FormView.WidgetType.TEXT};return colab.cell.newFormWidget(name,value,params,
this.callback_)};
colab.cell.newFormWidget=function(name,value,params,callback){switch(params["type"]){case colab.cell.FormView.WidgetType.SLIDER:return new colab.cell.SliderFormWidget(name,value,params,callback);case colab.cell.FormView.WidgetType.COMBOBOX:return new colab.cell.ComboBoxFormWidget(name,value,params,callback);case colab.cell.FormView.WidgetType.TEXT:return new colab.cell.TextFieldFormWidget(name,value,callback);default:console.error("Can not load unknown form view: ",params["type"]);return new colab.cell.TextFieldFormWidget(name,
value,callback)}};colab.cell.TextFieldFormWidget=function(name,value,callback){goog.base(this);this.name_=name;this.value_=value;this.callback_=callback};goog.inherits(colab.cell.TextFieldFormWidget,goog.ui.Component);
colab.cell.TextFieldFormWidget.prototype.createDom=function(){var element=goog.dom.createDom("div","formview-textfield");var label=goog.dom.createDom("div","formview-namelabel",this.name_.concat(": "));goog.dom.appendChild(element,label);var text=goog.dom.createDom("input",{"class":"formview-input","name":this.name_,"value":this.value_});goog.dom.appendChild(element,text);this.setElementInternal(element)};
colab.cell.TextFieldFormWidget.prototype.enterDocument=function(){goog.base(this,"enterDocument");var text=goog.dom.getElementByClass("formview-input",this.getElement());var widget=this;this.getHandler().listen(text,goog.events.EventType.INPUT,function(e){console.log(e);widget.callback_((e.target.name),(e.target.value))},false)};colab.cell.ComboBoxFormWidget=function(name,value,params,callback){goog.base(this);this.name_=name;this.value_=value;this.domain_=params["domain"]||[];this.callback_=callback};
goog.inherits(colab.cell.ComboBoxFormWidget,goog.ui.Component);colab.cell.ComboBoxFormWidget.prototype.createDom=function(){var element=goog.dom.createDom("div","formview-combobox");var label=goog.dom.createDom("div","formview-namelabel",this.name_.concat(": "));goog.dom.appendChild(element,label);this.setElementInternal(element)};
colab.cell.ComboBoxFormWidget.prototype.enterDocument=function(){goog.base(this,"enterDocument");var combobox=new goog.ui.ComboBox;goog.array.forEach(this.domain_,function(v){this.addItem(new goog.ui.MenuItem(v))},combobox);this.addChild(combobox,true);combobox.setValue(this.value_.replace(/\"/g,""));var widget=this;this.getHandler().listen(combobox,goog.ui.Component.EventType.CHANGE,function(e){widget.callback_(this.name_,'"'+e.target.getValue()+'"')},false)};
colab.cell.SliderFormWidget=function(name,value,params,callback){goog.base(this);this.name_=name;this.value_=value;this.params_=params;this.max=params["max"];this.min=params["min"];this.step=params["step"];this.callback_=callback};goog.inherits(colab.cell.SliderFormWidget,goog.ui.Component);
colab.cell.SliderFormWidget.prototype.createDom=function(){var element=goog.dom.createDom("div","formview-slider");var label=goog.dom.createDom("div","formview-namelabel",this.name_.concat(": "));goog.dom.appendChild(element,label);goog.dom.appendChild(element,goog.dom.createDom("div","formview-content"));this.valueLabel_=goog.dom.createDom("div","formview-valuelabel"," ["+this.value_+"]");goog.dom.appendChild(element,this.valueLabel_);this.setElementInternal(element)};
colab.cell.SliderFormWidget.prototype.getContentElement=function(){return goog.dom.getElementByClass("formview-content",this.getElement())};
colab.cell.SliderFormWidget.prototype.enterDocument=function(){goog.base(this,"enterDocument");var slider=new goog.ui.Slider;slider.setMaximum(this.max?this.max:100);slider.setMinimum(this.min?this.min:10);slider.setStep(this.step?this.step:1);this.addChild(slider,true);slider.setValue(Number(this.value_));var widget=this;this.getHandler().listen(slider,goog.ui.Component.EventType.CHANGE,function(e){goog.dom.setTextContent(widget.valueLabel_," ["+e.target.getValue()+"]");widget.callback_(widget.name_,
e.target.getValue())},false)};goog.provide("colab.cell.OutputArea");goog.require("goog.dom");goog.require("goog.ui.AnimatedZippy");goog.require("goog.ui.Component");goog.require("goog.ui.Zippy");goog.require("goog.ui.ZippyEvent");colab.cell.OutputArea=function(outputs,opt_cellId){this.outputs_=outputs;this.executeEphemeralScripts=false;this.iframeLoaded=false;this.cellId=opt_cellId;this.localContent_=outputs.length==0};goog.inherits(colab.cell.OutputArea,goog.ui.Component);
colab.cell.OutputArea.prototype.setHeaderContent=function(executionInfo){if(executionInfo){var headerContent=goog.dom.getElementByClass("output-header-content",this.getElement());var timeElem=goog.dom.createDom("span","output-header-content-time",executionInfo["time"]);var dateElem=goog.dom.createDom("span","output-header-content-dateuser",executionInfo["date"]+" by "+executionInfo["user"]);goog.dom.removeChildren(headerContent);goog.dom.appendChild(headerContent,timeElem);goog.dom.appendChild(headerContent,
dateElem)}};
colab.cell.OutputArea.prototype.createDom=function(){var element=goog.dom.createDom("div","output");var expandDiv=goog.dom.createDom("div","output-image");var hContent=goog.dom.createDom("div","output-header-content");var header=goog.dom.createDom("div","output-header");goog.dom.appendChild(header,expandDiv);goog.dom.append(header,"Output:");goog.dom.appendChild(header,hContent);goog.dom.appendChild(element,header);var content=goog.dom.createDom("div","output-content");goog.dom.appendChild(element,content);
this.setElementInternal(element)};colab.cell.OutputArea.prototype.getContentElement=function(){return goog.dom.getElementByClass("output-content",this.getElement())};
colab.cell.OutputArea.prototype.enterDocument=function(){goog.base(this,"enterDocument");goog.style.setElementShown(this.getElement(),this.outputs_.length!=0);var header=goog.dom.getElementByClass("output-header",this.getElement());this.zippy_=new goog.ui.AnimatedZippy(header,this.getContentElement(),true);this.realtimeUpdateHandler=goog.bind(this.outputsChanged_,this);this.realtimeOutputsRemovedHandler=goog.bind(this.outputsRemoved_,this);this.createOutput();this.outputs_.addEventListener(gapi.drive.realtime.EventType.VALUES_ADDED,
this.realtimeUpdateHandler);this.outputs_.addEventListener(gapi.drive.realtime.EventType.VALUES_REMOVED,this.realtimeOutputsRemovedHandler);this.outputs_.addEventListener(gapi.drive.realtime.EventType.VALUES_SET,this.realtimeUpdateHandler)};colab.cell.OutputArea.prototype.setVisible=function(value){goog.style.setElementShown(this.getElement(),value&&this.outputs_.length!=0)};colab.cell.OutputArea.prototype.clearOutput=function(){this.outputs_.clear()};
colab.cell.OutputArea.html="<head>"+'<link rel="stylesheet" href="css/ansi.css"/>'+'<link rel="stylesheet" href="css/main.css"/>'+"<script>"+"   IPython  = {};"+"   IPython.namespace = function() {};"+"\x3c/script>"+'<script src="/static/components/jquery/jquery.min.js">\x3c/script>'+'<script src="js/raw/cell/outputframe.js">\x3c/script>'+'<script src="/static/base/js/utils.js">\x3c/script>'+'<script src="/static/custom/colabtools.js">\x3c/script>'+'<script src="/static/js/interactive_widgets.js">\x3c/script>'+
'<script src="/static/notebook/js/outputarea.js">\x3c/script>'+"</head>"+'<body style="background: white;">'+'<div id="output-area">'+'  <span id="output-header"> </span>'+'  <div id="output-body"> </div>'+'  <span id="output-footer"> </span>'+"</div>"+"</body>";
colab.cell.OutputArea.prototype.createOutput=function(){if(colab.hashParams.nodisplayOutput)return;if(this.outputIframe)this.outputIframe.remove();console.log("Creating output");this.outputIframe=goog.dom.createDom("iframe",{height:"20px",srcdoc:colab.cell.OutputArea.html,sandbox:"allow-forms allow-scripts"});this.iframeLoaded=false;jQuery(this.outputIframe).css("height",0);this.outputHeight=0;var cell=this;goog.dom.appendChild(this.getContentElement(),this.outputIframe);this.height=0;this.outputIframe.onload=
function(){console.log("Loaded iframe");cell.iframeLoaded=true;cell.postUpdate({action:"config",value:{"cellId":cell.cellId,"allowEphemeralScripts":cell.allowEphemeralScripts_}});for(var i=0;i<cell.outputs_.length;i++)cell.updateOutput_(i)};this.outputIframe.onunload=function(){console.log("Frame unloaded")}};colab.cell.OutputArea.prototype.removeOutput=function(){if(this.outputIframe)this.outputIframe.remove();this.outputIframe=null};
colab.cell.OutputArea.prototype.resizeOutput=function(desiredHeight){var maxHeight=2*window.innerHeight/3;desiredHeight=Math.min(desiredHeight,maxHeight);if(this.height==desiredHeight)return;var heightIncrease=desiredHeight-this.height;this.height=desiredHeight;var enclosingDivHeight="initial";if(desiredHeight==0)enclosingDivHeight=0;var refScroll=window.scrollY;var scrollCell=colab.globalNotebook.getSelectedCell();var resizingCurrentCell=false;if(scrollCell&&scrollCell.isVisible()){var bounds=goog.style.getBounds(scrollCell.getElement());
refScroll=bounds.top;resizingCurrentCell=scrollCell.realtimeCell.id==this.cellId}var this_bounds=goog.style.getBounds(this.getContentElement());goog.style.setHeight(this.outputIframe,desiredHeight+"px");goog.style.setHeight(this.getContentElement(),enclosingDivHeight);if(this_bounds.top<=refScroll)jQuery("html, body").animate({"scrollTop":window.scrollY+heightIncrease});else if(resizingCurrentCell)scrollCell.scrollIntoView()};
colab.cell.OutputArea.prototype.postUpdate=function(data){if(!this.outputIframe.contentWindow||!this.iframeLoaded)console.error("No output window available");this.outputIframe.contentWindow.postMessage(data,"*")};colab.cell.OutputArea.prototype.allowEphemeralScripts=function(){this.allowEphemeralScripts_=true};colab.cell.OutputArea.prototype.clear=function(){this.outputs_.clear()};
colab.cell.OutputArea.prototype.handleKernelOutputMessage=function(msgType,content){var output=this.convertKernelOutput_(msgType,content);var lastOutput=null;var lastEl=this.outputs_.length-1;if(lastEl>=0)lastOutput=this.outputs_.get(lastEl);if(this.tryMerge((lastOutput),output))this.outputs_.set(lastEl,output);else this.outputs_.push(output)};
colab.cell.OutputArea.prototype.tryMerge=function(prevOut,nextOut){if(!prevOut)return false;if(prevOut["output_type"]!="stream"||nextOut["output_type"]!="stream")return false;if(prevOut["stream"]!=nextOut["stream"])return false;nextOut.text=prevOut.text+nextOut.text;return true};
colab.cell.OutputArea.prototype.outputsRemoved_=function(e){goog.style.setElementShown(this.getElement(),this.outputs_.length!=0);if(this.outputs_.length==0){this.createOutput();this.localContent_=true}else{this.localContent_=this.localContent_&&e.isLocal;if(this.iframeLoaded)this.postUpdate({action:"remove",index:e.index,num:e.values.length})}};
colab.cell.OutputArea.prototype.outputsChanged_=function(e){goog.style.setElementShown(this.getElement(),this.outputs_.length!=0);this.localContent_=this.localContent_&&e.isLocal;if(this.iframeLoaded){var values=(e).values||(e).newValues;for(var i=0;i<values.length;i++)this.updateOutput_(e.index+i)}};
colab.cell.OutputArea.prototype.convertKernelOutput_=function(msgType,content){var json=({});json["output_type"]=msgType;if(msgType==="stream"){json["text"]=content["data"];json["stream"]=content["name"]}else if(msgType==="display_data"){json=this.convertMimeTypes_(json,content["data"]);json["metadata"]=this.convertMimeTypes_(({}),content["metadata"])}else if(msgType==="pyout"){json["prompt_number"]=content["execution_count"];json=this.convertMimeTypes_(json,content["data"]);json["metadata"]=this.convertMimeTypes_(({}),
content["metadata"])}else if(msgType==="pyerr"){json["ename"]=content["ename"];json["evalue"]=content["evalue"];json["traceback"]=content["traceback"]}return json};
colab.cell.OutputArea.prototype.convertMimeTypes_=function(json,data){if(data===undefined)return json;if(data["text/plain"]!==undefined)json["text"]=data["text/plain"];if(data["text/html"]!==undefined)json["html"]=data["text/html"];if(data["image/svg+xml"]!==undefined)json["svg"]=data["image/svg+xml"];if(data["image/png"]!==undefined)json["png"]=data["image/png"];if(data["image/jpeg"]!==undefined)json["jpeg"]=data["image/jpeg"];if(data["text/latex"]!==undefined)json["latex"]=data["text/latex"];if(data["application/json"]!==
undefined)json["json"]=data["application/json"];if(data["application/javascript"]!==undefined)json["javascript"]=data["application/javascript"];return json};colab.cell.OutputArea.prototype.updateOutput_=function(outputIndex){if(!(outputIndex<this.outputs_.length)){console.error("Can't update non-existent output "+outputIndex);return}var rt_output=this.outputs_.get(outputIndex);this.postUpdate({action:"update",index:outputIndex,value:rt_output})};colab.cell.OutputArea.prototype.isLocalContent=function(){return this.localContent_};goog.provide("colab.cell.CodeCell");goog.require("colab.cell.Cell");goog.require("colab.cell.FormView");goog.require("colab.cell.OutputArea");goog.require("colab.drive.Permissions");goog.require("colab.services");goog.require("goog.date.DateTime");goog.require("goog.dom");goog.require("goog.dom.classes");goog.require("goog.ui.MenuItem");goog.require("goog.ui.ToolbarSelect");
colab.cell.CodeCell=function(realtimeCell,permissions){goog.base(this,realtimeCell,permissions);this.outputArea_=null;this.isRunning_=false;this.formView_=null};goog.inherits(colab.cell.CodeCell,colab.cell.Cell);colab.cell.CodeCell.ViewType={BOTH:"both",CODE:"code",FORM:"form"};
colab.cell.CodeCell.prototype.createToolbar=function(){goog.base(this,"createToolbar");var clearButton=new goog.ui.ToolbarButton("Clear");goog.events.listen(clearButton,goog.ui.Component.EventType.ACTION,function(e){this.clearOutput()},false,this);this.toolbar.addChildAt(clearButton,0,true);var runButton=new goog.ui.ToolbarButton("Run");goog.events.listen(runButton,goog.ui.Component.EventType.ACTION,function(e){this.execute(true)},false,this);this.toolbar.addChildAt(runButton,0,true);this.formViewSelect_=
new goog.ui.ToolbarSelect("");var viewTypes=goog.object.getValues(colab.cell.CodeCell.ViewType);goog.array.forEach(viewTypes,function(value){this.addItem(new goog.ui.MenuItem(value))},this.formViewSelect_);if(this.realtimeCell.has("cellView")){var viewIdx=viewTypes.indexOf(this.realtimeCell.get("cellView"));this.formViewSelect_.setSelectedIndex(viewIdx)}else this.formViewSelect_.setSelectedIndex(0);var events=[goog.ui.Component.EventType.SHOW,goog.ui.Component.EventType.HIDE,goog.ui.Component.EventType.ACTION];
goog.events.listen(this.formViewSelect_,events,function(e){switch(e.type){case goog.ui.Component.EventType.SHOW:goog.dom.classes.add(this.toolbarDiv,"cell-toolbar-visible");break;case goog.ui.Component.EventType.HIDE:goog.dom.classes.remove(this.toolbarDiv,"cell-toolbar-visible");break;case goog.ui.Component.EventType.ACTION:this.setView_((this.formViewSelect_.getValue()),true);break}},false,this);this.toolbar.addChildAt(this.formViewSelect_,0,true)};colab.cell.CodeCell.prototype.viewType_=colab.cell.CodeCell.ViewType.BOTH;
colab.cell.CodeCell.prototype.setView_=function(viewType,update){if(viewType)colab.cell.CodeCell.prototype.viewType_=(viewType);if(update&&viewType)this.realtimeCell.set("cellView",viewType);viewType=this.formView_.hasChildren()?colab.cell.CodeCell.prototype.viewType_:colab.cell.CodeCell.ViewType.CODE;if(this.formViewSelect_)goog.style.setElementShown(this.formViewSelect_.getElement(),this.formView_.hasChildren());switch(viewType){case colab.cell.CodeCell.ViewType.BOTH:this.formView_.show(true);this.formView_.setExpanded(false);
this.editor_.setVisible(true);break;case colab.cell.CodeCell.ViewType.CODE:this.formView_.show(false);this.editor_.setVisible(true);break;case colab.cell.CodeCell.ViewType.FORM:this.formView_.show(true);this.formView_.setExpanded(true);this.editor_.setVisible(false);break}};
colab.cell.CodeCell.prototype.createDom=function(){goog.base(this,"createDom");this.inputDiv_=goog.dom.createDom("div","inputarea");goog.dom.appendChild(this.mainContentDiv,this.inputDiv_);var runningDiv=goog.dom.createDom("div","running-status","Running");goog.dom.appendChild(this.mainContentDiv,runningDiv);goog.style.setElementShown(runningDiv,false)};
colab.cell.CodeCell.prototype.setDragging=function(value){goog.base(this,"setDragging",value);if(value)this.outputArea_.removeOutput();else this.outputArea_.createOutput();this.outputArea_.setVisible(!value);this.refresh()};colab.cell.CodeCell.prototype.clearOutput=function(){this.outputArea_.clearOutput();this.refresh()};
colab.cell.CodeCell.prototype.formCallback_=function(name,value){var t=this.editor_.getText();var re=new RegExp("("+name+"\\s*=).*(#\\s*@param.*)");this.formUpdate_=true;this.editor_.setText(t.replace(re,"$1 "+value+" $2"));this.formUpdate_=false};
colab.cell.CodeCell.prototype.enterDocument=function(){goog.base(this,"enterDocument");this.editor_=new colab.cell.Editor(this.realtimeCell.get("text"),true);this.addChild(this.editor_);this.editor_.render(this.inputDiv_);this.formView_=new colab.cell.FormView(goog.bind(this.formCallback_,this));this.addChild(this.formView_);this.formView_.render(this.inputDiv_);if(this.realtimeCell.has("cellView"))this.setView_(this.realtimeCell.get("cellView"),false);else this.setView_(colab.cell.CodeCell.ViewType.BOTH,
this.permissions.isEditable());this.updateFormView_();if(this.permissions.isEditable()){this.editor_.addOnChangeHandler(goog.bind(function(){if(!this.formUpdate_)this.updateFormView_()},this));this.editor_.addOnFocusHandler(goog.bind(this.selectCellHandler,this))}else this.editor_.setOption("readOnly","nocursor");this.outputArea_=new colab.cell.OutputArea(this.realtimeCell.get("outputs"),this.realtimeCell.id);this.addChild(this.outputArea_);this.outputArea_.render(this.mainContentDiv);if(this.realtimeCell.has("executionInfo"))this.outputArea_.setHeaderContent((this.realtimeCell.get("executionInfo")));
this.realtimeCell.addEventListener(gapi.drive.realtime.EventType.VALUE_CHANGED,goog.bind(this.realtimeUpdate_,this))};colab.cell.CodeCell.prototype.realtimeUpdate_=function(e){if(e.property=="executionInfo")this.outputArea_.setHeaderContent((e.newValue));else if(e.property=="cellView")this.setView_((e.newValue),false)};colab.cell.CodeCell.prototype.updateFormView_=function(){this.formView_.parseCode(this.editor_.getText());this.setView_(undefined,false)};
colab.cell.CodeCell.prototype.setRunning_=function(value){var runningElem=goog.dom.getElementByClass("running-status",this.getElement());goog.style.setElementShown(runningElem,value);this.isRunning_=value;this.refresh()};colab.cell.CodeCell.prototype.isTrustedContent=function(){return this.editor_.isTrustedContent()};colab.cell.CodeCell.prototype.connectedToKernel=function(){return!!(colab.globalKernel&&colab.globalKernel.running)};
colab.cell.CodeCell.prototype.execute=function(opt_isManual){if(!this.connectedToKernel()){colab.notification.showPrimary("Not connected to kernel.");this.setRunning_(false);return false}if(this.isRunning_){colab.notification.showPrimary("Already running!");return false}var isManual=opt_isManual===undefined?false:opt_isManual;if(isManual)this.editor_.setLocalContent(true);else if(!this.isTrustedContent())return false;this.setRunning_(true);this.outputArea_.clear();this.outputArea_.allowEphemeralScripts();
var callbacks=({"execute_reply":goog.bind(function(content){this.setRunning_(false);var ts=new goog.date.DateTime;var dateString=goog.string.format("(%s GMT) %02d-%02d-%02d",ts.getTimezoneOffsetString(),ts.getDate(),ts.getMonth()+1,ts.getYear()-2E3);var timeString=ts.toIsoTimeString();this.realtimeCell.set("executionInfo",{"content":content,"date":dateString,"time":timeString,"user":colab.globalMe.displayName})},this),"set_next_input":goog.bind(function(content){console.log("set_next_input not implemented: ",
content)},this),"input_request":goog.bind(function(content){console.log("input_request not implemented: ",content)},this),"clear_output":goog.bind(function(){this.outputArea_.clear()},this),"output":goog.bind(function(msgType,content){var metadata=content["metadata"];if(metadata&&metadata[colab.services.REQUEST_TYPE_KEY]){colab.services.handleKernelRequest(metadata);return}this.outputArea_.handleKernelOutputMessage(msgType,content)},this)});try{colab.globalKernel.execute(this.editor_.getText(),callbacks,
({silent:false,store_history:true}))}catch(e){this.setRunning_(false);console.error("Could not send execute message to Kernel: ",e);return false}return true};colab.cell.CodeCell.prototype.refresh=function(){goog.base(this,"refresh");this.editor_.refresh()};colab.cell.CodeCell.prototype.focusOnEditor=function(){this.editor_.focus()};colab.cell.CodeCell.prototype.setSelected=function(value){goog.base(this,"setSelected",value);if(!value)this.editor_.blur()};
colab.cell.CodeCell.prototype.getOutputArea=function(){return this.outputArea_};goog.provide("colab.tooltip");goog.provide("colab.tooltip.Tooltip");goog.require("goog.dom");goog.require("goog.ui.Tooltip");colab.tooltip.Tooltip=function(){this.elementCreated_=false};
colab.tooltip.Tooltip.prototype.initialize=function(){if(this.elementCreated_)return;this.tooltipEl=goog.dom.createDom("div","colab-tooltip");this.text=goog.dom.createDom("div","tooltiptext");this.arrow=goog.dom.createDom("div","pretooltiparrow");this.tooltipEl.style.setProperty("z-index","1000");this.tooltipEl.style.setProperty("min-width","100px");this.tooltipEl.appendChild(this.arrow);this.tooltipEl.appendChild(this.text);var tooltip=new goog.ui.Tooltip;this.tooltip=tooltip;tooltip.className="colab-tooltip";
tooltip.setElement(this.tooltipEl);tooltip.hidePopupElement();document.body.appendChild(this.tooltipEl);this.elementCreated_=true;this.shown_=false};colab.tooltip.Tooltip.prototype.show=function(x,y,arrowPoint,text){this.tooltip.showPopupElement(document.body);this.shown_=true;var el=this.tooltip.getElement();el.style.setProperty("left",x+"px");el.style.setProperty("top",y+"px");this.arrow.style.setProperty("left",arrowPoint+"px");this.text.innerHTML=IPython.utils.fixConsole(text)};
colab.tooltip.Tooltip.prototype.showAtCursor=function(editor,text){var lineCoords=editor.cursorCoords(false);var charCoords=editor.cursorCoords(true);var left=Math.max(lineCoords.left-70,30);this.left=left;this.show(left,charCoords.bottom+10,charCoords.left-left-30,text)};colab.tooltip.Tooltip.prototype.visible=function(){return this.shown_};
colab.tooltip.Tooltip.prototype.startFollowingCursor=function(editor){if(this.positionUpdateTask){clearInterval(this.positionUpdateTask);this.positionUpdateTask=null}this.positionUpdateTask=setInterval(goog.bind(this.followCursor,this,editor),300)};
colab.tooltip.Tooltip.prototype.followCursor=function(editor){if(!this.visible())return;var charCoords=editor.cursorCoords(true);var newPos=charCoords.left-this.left-30;var maxShift=this.tooltipEl.getBoundingClientRect().width-30;if(newPos<0){this.left+=newPos-maxShift/2;newPos=maxShift/2}if(maxShift<0)return;while(newPos>maxShift){this.left+=maxShift;newPos-=maxShift}jQuery(this.tooltipEl).animate({left:this.left,top:charCoords.bottom+10},200);jQuery(this.arrow).animate({"left":newPos},200)};
colab.tooltip.Tooltip.prototype.hide=function(){if(this.positionUpdateTask){clearInterval(this.positionUpdateTask);this.positionUpdateTask=null}this.tooltip.hidePopupElement();this.shown_=false};goog.provide("colab.cell.Editor");goog.require("colab.tooltip");goog.require("goog.dom");goog.require("goog.events");goog.require("goog.events.EventType");goog.require("goog.ui.Component");colab.cell.Editor=function(text,opt_codeCompletion){goog.base(this);this.tooltip_=colab.cell.Editor.tooltip;this.text_=text;this.codeCompletion_=!!opt_codeCompletion};goog.inherits(colab.cell.Editor,goog.ui.Component);colab.cell.Editor.prototype.getText=function(){return this.editor_.getValue()};
colab.cell.Editor.prototype.blur=function(){this.editor_.getInputField().blur()};colab.cell.Editor.prototype.isTrustedContent=function(){return this.isLocalContent_||(!colab.drive.documentShared||colab.globalNotebook&&!colab.globalSharingState.hasOtherWriters)};colab.cell.Editor.prototype.setLocalContent=function(value){this.isLocalContent_=value;this.refreshTrustedContent_()};
colab.cell.Editor.prototype.refreshTrustedContent_=function(){goog.dom.classes.enable(this.getElement(),"non-trusted",!this.isTrustedContent());var elem=goog.dom.getElementByClass("CodeMirror-gutter",this.getElement());if(!elem)return;if(!this.isTrustedContent())elem.title="This code has been modifed outside of "+"this session. Automatic running disabled.";else elem.title=""};colab.cell.Editor.prototype.setText=function(text){this.text_.setText(text)};
colab.cell.Editor.prototype.findFunction=function(preCursor,filterRe){var atSpace=preCursor.substr(-1)==" ";preCursor=preCursor.trim();if(atSpace){var p=preCursor.search(/%%?[_a-zA-Z0-9.]*$/);if(p<0)return null;return preCursor.substr(p)}if(preCursor.search(filterRe)==-1)return null;var pos=preCursor.length-1;var count=1;while(pos>=0){if(preCursor.charAt(pos)==")")count++;if(preCursor.charAt(pos)=="(")count--;if(count==0)break;pos--}var suffix=preCursor.substr(0,pos).trim();var p=suffix.search(/[_a-zA-Z0-9.]+$/);
if(p<0)return null;return suffix.substr(p)};
colab.cell.Editor.prototype.handleTooltip=function(opt_keepOnInsideFunction){var cur=this.editor_.getCursor();var preCursor=this.editor_.getRange({line:0,ch:0},cur);var allowedReg=opt_keepOnInsideFunction?/.$/:/[,(]$/;var functionToHelpWith=this.findFunction(preCursor,allowedReg);if(!functionToHelpWith){if(this.tooltip_.visible()){this.tooltip_.hide();return true}return false}var tooltip=this.tooltip_;var editor=this.editor_;var that=this;if(tooltip.visible()&&this.tooltipFunc==functionToHelpWith)return true;
var callbacks=({});if(!colab.globalKernel||!colab.globalKernel.running){colab.notification.showPrimary("Context help requires "+"a live connection to python");return false}callbacks.object_info_reply=function(r){var doc="Unrecognized request";if(r){doc="";if(r.definition)doc+=r.definition+"\n";if(r.docstring)doc+=r.docstring;if(!doc)doc="No DocString available";if(r.init_definition||r.init_docstring)doc+="\n\n__init__:\n";if(r.init_definition)doc+=r.init_definition+"\n";if(r.init_docstring)doc+=r.init_docstring}tooltip.showAtCursor(editor,
doc);tooltip.startFollowingCursor(editor);that.tooltipFunc=functionToHelpWith};colab.globalKernel.object_info_request(functionToHelpWith,callbacks);return true};
colab.cell.Editor.prototype.selectHighlightMode=function(){var firstline=this.editor_.getLine(0).split(/ +/,1);var magic=firstline[0];var highlighting={"%%javascript":"javascript","%%html":"htmlmixed","%%dremel_query":"text/x-sql","%dremel_query":"text/x-sql"};var highlightMode=highlighting[magic]||"text/x-python";this.editor_.setOption("mode",highlightMode)};colab.cell.Editor.prototype.updateCodeOverlays_=function(editor,event){if(this.tooltip_.visible())this.handleTooltip(true);return false};
colab.cell.Editor.prototype.handleTabForCodeHelp=function(editor){if(editor.somethingSelected())return false;var cur=editor.getCursor();var preCursor=editor.getRange(({line:cur.line,ch:0}),cur);if(this.tooltip_.visible()){this.tooltip_.hide();return true}if(this.handleTooltip())return true;if(preCursor.trim()=="")return false;this.tooltip_.hide();this.handleCodeCompletion();return true};
colab.cell.Editor.prototype.handleCodeCompletion=function(){var cm=this.editor_;var hintFunc=function(cm,callback){if(!colab.globalKernel||!colab.globalKernel.running){colab.notification.showPrimary("Autocomple requires live connection to Python!");return}var finishResponse=function(result){if(cursorPos!=cm.getCursor().ch){console.log("Ignoring stale response");return}var hint=({});hint.list=[];var MAX_AC_LENGTH=32;if(result.matches){var pi=result.matched_text.lastIndexOf(".")+1;result.matched_text=
result.matched_text.slice(pi);for(var i=0;i<result.matches.length;i++){var completion=result.matches[i].slice(pi);var displayText=completion;if(displayText.length>MAX_AC_LENGTH)displayText="..."+displayText.slice(displayText.length-MAX_AC_LENGTH+3);var oneHint={"text":completion,"displayText":displayText};hint.list.push(oneHint)}}hint.from=({line:cm.getCursor().line,ch:cm.getCursor().ch-result.matched_text.length});hint.to=cm.getCursor();CodeMirror.on((hint),"shown",function(){var hintEl=jQuery(".CodeMirror-hints");
var top=parseInt(hintEl.css("top"),10);var height=parseInt(hintEl.css("height"),10);var pos=cm.cursorCoords(hint.from);if(top+height<pos.top)hintEl.css("top",pos.top-height-7+"px")});(callback)(hint)};var cursorPos=cm.getCursor().ch;colab.globalKernel.complete(cm.getLine(cm.getCursor().line)||"",cm.getCursor().ch||0,({complete_reply:finishResponse}))};CodeMirror.showHint(cm,hintFunc,({async:true}))};
colab.cell.Editor.prototype.updateCollaborativeText_=function(){this.updating_=true;this.setText(this.editor_.getValue());this.updating_=false};colab.cell.Editor.prototype.updateEditor_=function(e){this.setLocalContent(e.isLocal);if(!this.updating_)this.editor_.setValue(this.text_.getText())};colab.cell.Editor.prototype.addOnChangeHandler=function(f){this.editor_.on(goog.events.EventType.CHANGE,f)};
colab.cell.Editor.prototype.addOnFocusHandler=function(f){this.editor_.on(goog.events.EventType.FOCUS,f)};colab.cell.Editor.prototype.focus=function(){this.editor_.focus()};colab.cell.Editor.prototype.refresh=function(){this.editor_.setSize("100%");this.editor_.refresh()};colab.cell.Editor.prototype.setOption=function(name,value){this.editor_.setOption(name,value)};colab.cell.Editor.prototype.setVisible=function(value){goog.style.setElementShown(this.getElement(),value)};
colab.cell.Editor.prototype.createDom=function(){var element=goog.dom.createDom("div","editor");this.setElementInternal(element)};colab.cell.Editor.tooltip=new colab.tooltip.Tooltip;
colab.cell.Editor.prototype.tabHandler=function(cm){if(cm.doc.somethingSelected())return CodeMirror.Pass;if(this.codeCompletion_&&this.handleTabForCodeHelp(cm))return false;var spacesPerTab=this.indentSize;var spacesToInsert=spacesPerTab-cm.doc.getCursor(this.indentSize).ch%spacesPerTab;var spaces=Array(spacesToInsert+1).join(" ");cm.replaceSelection(spaces,"end","+input")};
colab.cell.Editor.prototype.enterDocument=function(){goog.base(this,"enterDocument");this.tooltip_.initialize();this.indentSize=2;var editorParams=({lineNumbers:true,mode:"text/x-python",matchBrackets:true,viewportMargin:10,tabSize:this.indentSize,extraKeys:{Tab:goog.bind(this.tabHandler,this)}});var editorElement=(this.getElement());this.editor_=new CodeMirror(editorElement,(editorParams));this.editor_.on(goog.events.EventType.CHANGE,goog.bind(this.selectHighlightMode,this));this.editor_.on(goog.events.EventType.CHANGE,
goog.bind(this.updateCodeOverlays_,this));this.editor_.on("cursorActivity",goog.bind(this.updateCodeOverlays_,this));this.editor_.setValue(this.text_.getText());this.selectHighlightMode();this.editor_.on(goog.events.EventType.CHANGE,goog.bind(this.updateCollaborativeText_,this));this.setLocalContent(this.editor_.getValue()==="");this.getHandler().listenWithScope(colab.globalSharingState,colab.sharing.STATE_UPDATED,this.refreshTrustedContent_,false,this);this.text_.addEventListener(gapi.drive.realtime.EventType.TEXT_INSERTED,
goog.bind(this.updateEditor_,this));this.text_.addEventListener(gapi.drive.realtime.EventType.TEXT_DELETED,goog.bind(this.updateEditor_,this));this.editor_.on(goog.events.EventType.BLUR,goog.bind(this.tooltip_.hide,this.tooltip_))};
colab.cell.Editor.prototype.exitDocument=function(){goog.base(this,"exitDocument");this.text_.removeEventListener(gapi.drive.realtime.EventType.TEXT_INSERTED,goog.bind(this.updateEditor_,this));this.text_.removeEventListener(gapi.drive.realtime.EventType.TEXT_DELETED,goog.bind(this.updateEditor_,this));this.editor_=null};goog.provide("colab.cell.TextCell");goog.require("colab.cell.Cell");goog.require("colab.cell.Editor");goog.require("colab.drive.Permissions");goog.require("goog.dom");goog.require("goog.dom.classes");goog.require("goog.events");goog.require("goog.ui.ToolbarToggleButton");colab.cell.TextCell=function(realtimeCell,permissions){goog.base(this,realtimeCell,permissions);this.markdownDiv_=null};goog.inherits(colab.cell.TextCell,colab.cell.Cell);colab.cell.TextCell.EDIT_CSS_NAME_="edit";
colab.cell.TextCell.prototype.updateMarkdown_=function(){if(this.markdownDiv_!=null){var markdownConverter=Markdown.getSanitizingConverter();var text=this.editor_.getText();if(text=="")text="Double-click to edit";var text_and_math=IPython.mathjaxutils.remove_math(text);text=text_and_math[0];var math=text_and_math[1];var html=markdownConverter.makeHtml(text);if(math.length>0)html=jQuery(IPython.mathjaxutils.replace_math(html,math));jQuery(this.markdownDiv_).html(html);if(math.length>0)MathJax.Hub.Queue(["Typeset",
MathJax.Hub,this.markdownDiv_])}else console.error("Markdown Element not initialized. Cannot update Markdown.")};colab.cell.TextCell.prototype.refresh=function(){goog.base(this,"refresh");this.editor_.refresh()};colab.cell.TextCell.prototype.setSelected=function(value){goog.base(this,"setSelected",value);if(!value)this.setEditing(false)};
colab.cell.TextCell.prototype.enterDocument=function(){goog.base(this,"enterDocument");this.markdownDiv_=goog.dom.createDom("div","markdown");goog.dom.appendChild(this.mainContentDiv,this.markdownDiv_);this.editor_=new colab.cell.Editor(this.realtimeCell.get("text"));this.addChild(this.editor_);this.editor_.render(this.mainContentDiv);this.editor_.setOption("lineNumbers",false);this.editor_.setOption("lineWrapping",true);this.editor_.setOption("mode","text/x-markdown");this.updateMarkdown_();this.editor_.addOnChangeHandler(goog.bind(this.updateMarkdown_,
this));if(!this.permissions.isEditable())this.editor_.setOption("readOnly","nocursor");var textCell=this;this.getHandler().listen(this.markdownDiv_,goog.events.EventType.DBLCLICK,function(e){if(!textCell.permissions.isEditable())return;var editStatus=goog.dom.classes.has(textCell.getElement(),colab.cell.TextCell.EDIT_CSS_NAME_);textCell.setEditing(!editStatus)},false);this.refresh()};
colab.cell.TextCell.prototype.setEditing=function(value){var classAdded=goog.dom.classes.enable(this.getElement(),colab.cell.TextCell.EDIT_CSS_NAME_,value);this.refresh();if(value)this.editor_.focus()};colab.cell.TextCell.prototype.exitDocument=function(){goog.base(this,"exitDocument");this.editor_.dispose()};goog.provide("colab.cell");goog.provide("colab.cell.CellType");goog.require("colab.cell.Cell");goog.require("colab.cell.CodeCell");goog.require("colab.cell.TextCell");colab.cell.CellType={CODE:"code",TEXT:"text"};colab.cell.cellFromRealtime=function(realtimeCell,permissions){if(realtimeCell.get("type")==colab.cell.CellType.CODE)var cell=new colab.cell.CodeCell(realtimeCell,permissions);else cell=new colab.cell.TextCell(realtimeCell,permissions);return cell};
colab.cell.newRealtimeCell=function(model,type){var realtimeCell=model.createMap();realtimeCell.set("text",model.createString());realtimeCell.set("type",type);realtimeCell.set("collaborators",model.createList());realtimeCell.set("commentsSentinel",model.createString());if(type==colab.cell.CellType.CODE)realtimeCell.set("outputs",model.createList());return realtimeCell};goog.provide("goog.date.relative");goog.provide("goog.date.relative.TimeDeltaFormatter");goog.provide("goog.date.relative.Unit");goog.require("goog.i18n.DateTimeFormat");goog.date.relative.MINUTE_MS_=6E4;goog.date.relative.DAY_MS_=864E5;goog.date.relative.Unit={MINUTES:0,HOURS:1,DAYS:2};goog.date.relative.fullDateFormatter_;goog.date.relative.shortTimeFormatter_;goog.date.relative.monthDateFormatter_;goog.date.relative.TimeDeltaFormatter;goog.date.relative.formatTimeDelta_;
goog.date.relative.setTimeDeltaFormatter=function(formatter){goog.date.relative.formatTimeDelta_=formatter};goog.date.relative.formatMonth_=function(date){if(!goog.date.relative.monthDateFormatter_)goog.date.relative.monthDateFormatter_=new goog.i18n.DateTimeFormat("MMM dd");return goog.date.relative.monthDateFormatter_.format(date)};
goog.date.relative.formatShortTime_=function(date){if(!goog.date.relative.shortTimeFormatter_)goog.date.relative.shortTimeFormatter_=new goog.i18n.DateTimeFormat(goog.i18n.DateTimeFormat.Format.SHORT_TIME);return goog.date.relative.shortTimeFormatter_.format(date)};goog.date.relative.formatFullDate_=function(date){if(!goog.date.relative.fullDateFormatter_)goog.date.relative.fullDateFormatter_=new goog.i18n.DateTimeFormat(goog.i18n.DateTimeFormat.Format.FULL_DATE);return goog.date.relative.fullDateFormatter_.format(date)};
goog.date.relative.format=function(dateMs){var now=goog.now();var delta=Math.floor((now-dateMs)/goog.date.relative.MINUTE_MS_);var future=false;if(delta<0){future=true;delta*=-1}if(delta<60)return goog.date.relative.formatTimeDelta_(delta,future,goog.date.relative.Unit.MINUTES);else{delta=Math.floor(delta/60);if(delta<24)return goog.date.relative.formatTimeDelta_(delta,future,goog.date.relative.Unit.HOURS);else{var midnight=new Date(goog.now());midnight.setHours(0);midnight.setMinutes(0);midnight.setSeconds(0);
midnight.setMilliseconds(0);delta=Math.ceil((midnight.getTime()-dateMs)/goog.date.relative.DAY_MS_);if(future)delta*=-1;if(delta<14)return goog.date.relative.formatTimeDelta_(delta,future,goog.date.relative.Unit.DAYS);else return""}}};goog.date.relative.formatPast=function(dateMs){var now=goog.now();if(now<dateMs)dateMs=now;return goog.date.relative.format(dateMs)};
goog.date.relative.formatDay=function(dateMs,opt_formatter){var today=new Date(goog.now());today.setHours(0);today.setMinutes(0);today.setSeconds(0);today.setMilliseconds(0);var yesterday=new Date(today.getTime()-goog.date.relative.DAY_MS_);var tomorrow=new Date(today.getTime()+goog.date.relative.DAY_MS_);var dayAfterTomorrow=new Date(today.getTime()+2*goog.date.relative.DAY_MS_);var message;if(dateMs>=tomorrow.getTime()&&dateMs<dayAfterTomorrow.getTime()){var MSG_TOMORROW=goog.getMsg("Tomorrow");
message=MSG_TOMORROW}else if(dateMs>=today.getTime()&&dateMs<tomorrow.getTime()){var MSG_TODAY=goog.getMsg("Today");message=MSG_TODAY}else if(dateMs>=yesterday.getTime()&&dateMs<today.getTime()){var MSG_YESTERDAY=goog.getMsg("Yesterday");message=MSG_YESTERDAY}else{var formatFunction=opt_formatter||goog.date.relative.formatMonth_;message=formatFunction(new Date(dateMs))}return message};
goog.date.relative.getDateString=function(date,opt_shortTimeMsg,opt_fullDateMsg){return goog.date.relative.getDateString_(date,goog.date.relative.format,opt_shortTimeMsg,opt_fullDateMsg)};goog.date.relative.getPastDateString=function(date,opt_shortTimeMsg,opt_fullDateMsg){return goog.date.relative.getDateString_(date,goog.date.relative.formatPast,opt_shortTimeMsg,opt_fullDateMsg)};
goog.date.relative.getDateString_=function(date,relativeFormatter,opt_shortTimeMsg,opt_fullDateMsg){var dateMs=date.getTime();var relativeDate=relativeFormatter(dateMs);if(relativeDate)relativeDate=" ("+relativeDate+")";var delta=Math.floor((goog.now()-dateMs)/goog.date.relative.MINUTE_MS_);if(delta<60*24)return(opt_shortTimeMsg||goog.date.relative.formatShortTime_(date))+relativeDate;else return(opt_fullDateMsg||goog.date.relative.formatFullDate_(date))+relativeDate};
goog.date.relative.getMessage_=function(delta,future,unit){var deltaFormatted=goog.i18n.DateTimeFormat.localizeNumbers(delta);if(!future&&unit==goog.date.relative.Unit.MINUTES){var MSG_MINUTES_AGO_SINGULAR=goog.getMsg("{$num} minute ago",{"num":deltaFormatted});var MSG_MINUTES_AGO_PLURAL=goog.getMsg("{$num} minutes ago",{"num":deltaFormatted});return delta==1?MSG_MINUTES_AGO_SINGULAR:MSG_MINUTES_AGO_PLURAL}else if(future&&unit==goog.date.relative.Unit.MINUTES){var MSG_IN_MINUTES_SINGULAR=goog.getMsg("in {$num} minute",
{"num":deltaFormatted});var MSG_IN_MINUTES_PLURAL=goog.getMsg("in {$num} minutes",{"num":deltaFormatted});return delta==1?MSG_IN_MINUTES_SINGULAR:MSG_IN_MINUTES_PLURAL}else if(!future&&unit==goog.date.relative.Unit.HOURS){var MSG_HOURS_AGO_SINGULAR=goog.getMsg("{$num} hour ago",{"num":deltaFormatted});var MSG_HOURS_AGO_PLURAL=goog.getMsg("{$num} hours ago",{"num":deltaFormatted});return delta==1?MSG_HOURS_AGO_SINGULAR:MSG_HOURS_AGO_PLURAL}else if(future&&unit==goog.date.relative.Unit.HOURS){var MSG_IN_HOURS_SINGULAR=
goog.getMsg("in {$num} hour",{"num":deltaFormatted});var MSG_IN_HOURS_PLURAL=goog.getMsg("in {$num} hours",{"num":deltaFormatted});return delta==1?MSG_IN_HOURS_SINGULAR:MSG_IN_HOURS_PLURAL}else if(!future&&unit==goog.date.relative.Unit.DAYS){var MSG_DAYS_AGO_SINGULAR=goog.getMsg("{$num} day ago",{"num":deltaFormatted});var MSG_DAYS_AGO_PLURAL=goog.getMsg("{$num} days ago",{"num":deltaFormatted});return delta==1?MSG_DAYS_AGO_SINGULAR:MSG_DAYS_AGO_PLURAL}else if(future&&unit==goog.date.relative.Unit.DAYS){var MSG_IN_DAYS_SINGULAR=
goog.getMsg("in {$num} day",{"num":deltaFormatted});var MSG_IN_DAYS_PLURAL=goog.getMsg("in {$num} days",{"num":deltaFormatted});return delta==1?MSG_IN_DAYS_SINGULAR:MSG_IN_DAYS_PLURAL}else return""};goog.date.relative.setTimeDeltaFormatter(goog.date.relative.getMessage_);goog.provide("goog.dom.forms");goog.require("goog.structs.Map");goog.dom.forms.getFormDataMap=function(form){var map=new goog.structs.Map;goog.dom.forms.getFormDataHelper_(form,map,goog.dom.forms.addFormDataToMap_);return map};goog.dom.forms.getFormDataString=function(form){var sb=[];goog.dom.forms.getFormDataHelper_(form,sb,goog.dom.forms.addFormDataToStringBuffer_);return sb.join("&")};
goog.dom.forms.getFormDataHelper_=function(form,result,fnAppend){var els=form.elements;for(var el,i=0;el=els[i];i++){if(el.form!=form||(el.disabled||el.tagName.toLowerCase()=="fieldset"))continue;var name=el.name;switch(el.type.toLowerCase()){case "file":case "submit":case "reset":case "button":break;case "select-multiple":var values=goog.dom.forms.getValue(el);if(values!=null)for(var value,j=0;value=values[j];j++)fnAppend(result,name,value);break;default:var value=goog.dom.forms.getValue(el);if(value!=
null)fnAppend(result,name,value)}}var inputs=form.getElementsByTagName("input");for(var input,i=0;input=inputs[i];i++)if(input.form==form&&input.type.toLowerCase()=="image"){name=input.name;fnAppend(result,name,input.value);fnAppend(result,name+".x","0");fnAppend(result,name+".y","0")}};goog.dom.forms.addFormDataToMap_=function(map,name,value){var array=map.get(name);if(!array){array=[];map.set(name,array)}array.push(value)};
goog.dom.forms.addFormDataToStringBuffer_=function(sb,name,value){sb.push(encodeURIComponent(name)+"="+encodeURIComponent(value))};goog.dom.forms.hasFileInput=function(form){var els=form.elements;for(var el,i=0;el=els[i];i++)if(!el.disabled&&(el.type&&el.type.toLowerCase()=="file"))return true;return false};
goog.dom.forms.setDisabled=function(el,disabled){if(el.tagName=="FORM"){var els=el.elements;for(var i=0;el=els[i];i++)goog.dom.forms.setDisabled(el,disabled)}else{if(disabled==true)el.blur();el.disabled=disabled}};goog.dom.forms.focusAndSelect=function(el){el.focus();if(el.select)el.select()};goog.dom.forms.hasValue=function(el){var value=goog.dom.forms.getValue(el);return!!value};goog.dom.forms.hasValueByName=function(form,name){var value=goog.dom.forms.getValueByName(form,name);return!!value};
goog.dom.forms.getValue=function(el){var type=el.type;if(!goog.isDef(type))return null;switch(type.toLowerCase()){case "checkbox":case "radio":return goog.dom.forms.getInputChecked_(el);case "select-one":return goog.dom.forms.getSelectSingle_(el);case "select-multiple":return goog.dom.forms.getSelectMultiple_(el);default:return goog.isDef(el.value)?el.value:null}};goog.dom.$F=goog.dom.forms.getValue;
goog.dom.forms.getValueByName=function(form,name){var els=form.elements[name];if(els)if(els.type)return goog.dom.forms.getValue(els);else for(var i=0;i<els.length;i++){var val=goog.dom.forms.getValue(els[i]);if(val)return val}return null};goog.dom.forms.getInputChecked_=function(el){return el.checked?el.value:null};goog.dom.forms.getSelectSingle_=function(el){var selectedIndex=el.selectedIndex;return selectedIndex>=0?el.options[selectedIndex].value:null};
goog.dom.forms.getSelectMultiple_=function(el){var values=[];for(var option,i=0;option=el.options[i];i++)if(option.selected)values.push(option.value);return values.length?values:null};
goog.dom.forms.setValue=function(el,opt_value){var type=el.type;if(goog.isDef(type))switch(type.toLowerCase()){case "checkbox":case "radio":goog.dom.forms.setInputChecked_(el,(opt_value));break;case "select-one":goog.dom.forms.setSelectSingle_(el,(opt_value));break;case "select-multiple":goog.dom.forms.setSelectMultiple_(el,(opt_value));break;default:el.value=goog.isDefAndNotNull(opt_value)?opt_value:""}};goog.dom.forms.setInputChecked_=function(el,opt_value){el.checked=opt_value?"checked":null};
goog.dom.forms.setSelectSingle_=function(el,opt_value){el.selectedIndex=-1;if(goog.isString(opt_value))for(var option,i=0;option=el.options[i];i++)if(option.value==opt_value){option.selected=true;break}};goog.dom.forms.setSelectMultiple_=function(el,opt_value){if(goog.isString(opt_value))opt_value=[opt_value];for(var option,i=0;option=el.options[i];i++){option.selected=false;if(opt_value)for(var value,j=0;value=opt_value[j];j++)if(option.value==value)option.selected=true}};goog.provide("colab.Comment");goog.provide("colab.CommentsWidget");goog.provide("colab.NewComment");goog.require("colab.drive");goog.require("colab.drive.Permissions");goog.require("goog.date.relative");goog.require("goog.dom");goog.require("goog.dom.forms");
colab.CommentsWidget=function(commentSentinel,permissions){this.permissions_=permissions;var that=this;this.comments=[];this.currentComment=null;this.user=null;this.activityBox=goog.dom.getElement("comments-box");this.commentSentinel=commentSentinel;this.commentSentinel.addEventListener(gapi.drive.realtime.EventType.VALUES_SET,function(event){if(!event.isLocal)that.commentsUpdated((that.commentSentinel.get(0)))});colab.drive.fileId.promise.then(function(fileId){that.fileId=fileId;var request=gapi.client.drive.about.get();
var acceptResponse=function(response){that.user=response.user;that.getCommentsList()};request.execute(acceptResponse)});var commentsButton=goog.dom.getElement("comments");commentsButton.onclick=goog.bind(this.toggle,this)};
colab.CommentsWidget.prototype.getCommentsList=function(){var that=this;var request=gapi.client.drive.comments.list(({fileId:this.fileId}));request.execute(function(response){if(response.error){console.log("Unable to execute drive list comments request",response);return}var comments=response.items||[];that.redrawCommentsList(comments)})};
colab.CommentsWidget.prototype.redrawCommentsList=function(comments){goog.dom.removeChildren(this.activityBox);if(this.permissions_.isCommentable()){if(!this.currentComment)this.currentComment=new colab.NewComment(this.user.picture.url,goog.bind(this.insertComment,this));goog.dom.appendChild(this.activityBox,this.currentComment.element)}this.comments=[];for(var i=0;i<comments.length;i++){var comment=new colab.Comment(comments[i]);this.comments.push(comment);goog.dom.appendChild(this.activityBox,comment.element)}};
colab.CommentsWidget.prototype.insertComment=function(content){var that=this;var body={"content":content};var request=gapi.client.drive.comments.insert({"fileId":this.fileId,"resource":body});request.execute(function(response){if(response.error){console.log("Unable to execute drive insert comment request",response);return}that.currentComment=null;that.getCommentsList();that.touchCommentSentinel()})};colab.CommentsWidget.prototype.toggle=function(){goog.style.setElementShown(this.activityBox,!goog.style.isElementShown(this.activityBox))};
colab.CommentsWidget.prototype.touchCommentSentinel=function(){this.commentSentinel.set(0,(new Date).toISOString())};colab.CommentsWidget.prototype.commentsUpdated=function(timestamp){this.getCommentsList()};colab.Comment=function(comment){this.comment_=comment;this.element=null;this.createElement()};
colab.Comment.prototype.createElement=function(){this.element=goog.dom.createDom("div",{className:"comments-comment"});var image=goog.dom.createDom("img",{className:"comments-image",width:48,height:48,src:"https:"+this.comment_["author"]["picture"]["url"]});goog.dom.appendChild(this.element,image);var content=goog.dom.createDom("div",{className:"comments-content"});goog.dom.appendChild(this.element,content);var commentDate=goog.dom.createDom("div",{className:"comments-date"});var date=new goog.date.DateTime;
goog.date.setIso8601DateTime(date,this.comment_["modifiedDate"]);commentDate.innerHTML=goog.date.relative.getDateString(date);goog.dom.appendChild(content,commentDate);var authorName=goog.dom.createDom("div");authorName.innerHTML=this.comment_["author"]["displayName"];goog.dom.appendChild(content,authorName);var text=goog.dom.createDom("div",{className:"comments-text"});text.innerHTML=this.comment_["htmlContent"];goog.dom.appendChild(content,text)};
colab.NewComment=function(userImageUrl,onComment){this.element=null;this.text=null;this.commentButton=null;this.cancelButton=null;this.createElement(userImageUrl);this.onComment=onComment};
colab.NewComment.prototype.createElement=function(userImageUrl){var that=this;this.element=goog.dom.createDom("div",{className:"comments-comment"});var image=goog.dom.createDom("img",{className:"comments-image",width:48,height:48,src:userImageUrl});goog.dom.appendChild(this.element,image);var content=goog.dom.createDom("div",{className:"comments-content"});goog.dom.appendChild(this.element,content);this.text=goog.dom.createDom("textarea",{type:"text",className:"comments-input",placeholder:"Comment..."});
this.text.onkeypress=goog.bind(this.onChange,this);goog.dom.appendChild(content,this.text);this.commentButton=goog.dom.createDom("button",{className:"realtime-button",innerHTML:"Comment"});this.commentButton.onclick=function(){goog.dom.forms.setDisabled(that.commentButton,true);goog.dom.forms.setDisabled(that.cancelButton,true);that.onComment(that.text.value)};goog.style.setElementShown(this.commentButton,false);goog.dom.appendChild(content,this.commentButton);this.cancelButton=goog.dom.createDom("button",
{className:"realtime-button comments-button",innerHTML:"Cancel"});this.cancelButton.onclick=function(){that.text.value="";that.fixHeight();goog.style.setElementShown(that.commentButton,false);goog.style.setElementShown(that.cancelButton,false)};goog.style.setElementShown(this.cancelButton,false);goog.dom.appendChild(content,this.cancelButton)};
colab.NewComment.prototype.onChange=function(){this.fixHeight();goog.style.setElementShown(this.commentButton,true);goog.style.setElementShown(this.cancelButton,true)};colab.NewComment.prototype.fixHeight=function(){this.text.style.height="1px";this.text.style.height=12+this.text.scrollHeight+"px"};goog.require("colab.drive");goog.require("goog.events.EventTarget");goog.provide("colab.sharing");goog.provide("colab.sharing.SharingState");colab.sharing.SharingState=function(fileId){goog.base(this);this.hasOtherWriters=true;this.fileId=fileId;var that=this;colab.drive.clientLoaded.then(function(){that.update()})};goog.inherits(colab.sharing.SharingState,goog.events.EventTarget);
colab.sharing.SharingState.prototype.update=function(){var request=gapi.client.drive.permissions.list({"fileId":this.fileId});request.execute(goog.bind(this.receiveUpdate_,this))};colab.sharing.STATE_UPDATED="state-updated";
colab.sharing.SharingState.prototype.receiveUpdate_=function(permissions){setTimeout(goog.bind(this.update,this),60*1E3);this.lastPermissions=permissions;if(permissions.error)return;var prevHasOtherWriters=this.hasOtherWriters;this.hasOtherWriters=goog.array.reduce(permissions.items,function(p,v){if(v.role!="reader"&&v.id!==colab.drive.userPermissionId)return true;else return p},false);if(prevHasOtherWriters!=this.hasOtherWriters)this.dispatchEvent(colab.sharing.STATE_UPDATED)};goog.provide("colab.Undo");colab.Undo=function(cells){this.cells=cells;this.stack=[];this.redoStack=[]};colab.Undo.OpType={INSERT:"insert",DELETE:"delete"};colab.Undo.prototype.findNextCell=function(cell){var idx=this.cells.indexOf(cell);if(idx<0)return undefined;if(idx==this.cells.length-1)return null;return this.cells.get(idx+1)};colab.Undo.Operation=function(type,thisCell,nextCell,opt_numCompounded){this.type=type;this.thisCell=thisCell;this.nextCell=nextCell;this.numCompounded=opt_numCompounded};
colab.Undo.prototype.record=function(type,cell,opt_position){if(type==colab.Undo.OpType.INSERT){var position=opt_position||0;this.cells.insert(position,cell)}var nextCell=this.findNextCell(cell);if(nextCell===undefined)console.error("Can't record undo operation when cell is not present",cell);this.stack.push(new colab.Undo.Operation(type,cell,nextCell||null));this.redoStack=[];if(type==colab.Undo.OpType.DELETE)this.cells.removeValue(cell)};
colab.Undo.prototype.recordMove=function(insertAfterRemovePosition,cell){this.record(colab.Undo.OpType.DELETE,cell);this.record(colab.Undo.OpType.INSERT,cell,insertAfterRemovePosition);this.compound(2)};colab.Undo.prototype.recordInsert=function(insertPosition,cell){this.record(colab.Undo.OpType.INSERT,cell,insertPosition)};colab.Undo.prototype.recordDelete=function(cell){this.record(colab.Undo.OpType.DELETE,cell)};
colab.Undo.prototype.compound=function(num){var stack=this.stack;if(num>stack.length)num=stack.length;var t=stack.length-1;for(var i=0;i<num;i++)stack[t-i].numCompounded=num};
colab.Undo.prototype.undo=function(opt_stack,opt_redoStack,opt_ignoreExtras){var stack=opt_stack||this.stack;var redo=opt_redoStack||this.redoStack;var action=stack.pop();if(!action)return;var extras=opt_ignoreExtras?0:action.numCompounded;if(extras){console.log("compounding ",extras," undos ");stack.push(action);for(var i=0;i<extras;i++)this.undo(opt_stack,opt_redoStack,true);return}var redoAction=colab.Undo.OpType.INSERT;if(action.type==colab.Undo.OpType.INSERT){redoAction=colab.Undo.OpType.DELETE;
this.cells.removeValue(action.thisCell)}else if(action.nextCell==null)this.cells.push((action.thisCell));else{var idx=this.cells.indexOf(action.nextCell);this.cells.insert(idx,(action.thisCell))}redo.push(new colab.Undo.Operation(redoAction,action.thisCell,action.nextCell,action.numCompounded))};colab.Undo.prototype.redo=function(){this.undo(this.redoStack,this.stack)};goog.provide("colab.CellDragger");goog.provide("colab.Notebook");goog.require("colab.CommentsWidget");goog.require("colab.Undo");goog.require("colab.cell");goog.require("colab.cell.Cell");goog.require("colab.drive.Permissions");goog.require("goog.array");goog.require("goog.dom");goog.require("goog.dom.classes");goog.require("goog.fx.DragListDirection");goog.require("goog.fx.DragListGroup");goog.require("goog.fx.dom.FadeInAndShow");goog.require("goog.fx.dom.FadeOutAndHide");goog.require("goog.json");
colab.Notebook=function(model,permissions){this.cells_=[];this.permissions_=permissions;this.realtimeCells_=model.getRoot().get("cells");this.history_=new colab.Undo(this.realtimeCells_);this.model=model;this.listeners_={};var readOnly=model.isReadOnly;var contentDiv=goog.dom.getElement("content");this.contentDiv=contentDiv;for(var i=0;i<this.realtimeCells_.length;i++){var rt_cell=(this.realtimeCells_.get(i));var cell=colab.cell.cellFromRealtime(rt_cell,this.permissions_);if(!readOnly&&!rt_cell.has("commentsSentinel"))rt_cell.set("commentsSentinel",
model.createString());if(!readOnly&&!rt_cell.has("collaborators"))rt_cell.set("collaborators",model.createList());this.cells_.push(cell);cell.render(contentDiv)}if(this.permissions_.isEditable())this.makeDraggable_();this.realtimeCells_.addEventListener(gapi.drive.realtime.EventType.VALUES_ADDED,goog.bind(this.realtimeCellsAdded_,this));this.realtimeCells_.addEventListener(gapi.drive.realtime.EventType.VALUES_REMOVED,goog.bind(this.realtimeCellsRemoved_,this));this.realtimeCells_.addEventListener(gapi.drive.realtime.EventType.VALUES_SET,
goog.bind(this.realtimeCellsSet_,this));if(!model.getRoot().get("sentinel"))model.getRoot().set("sentinel",model.createList([(new Date).toISOString()]));var commentSentinel=model.getRoot().get("sentinel");this.commentsWidet=new colab.CommentsWidget(commentSentinel,this.permissions_);window.addEventListener("message",goog.bind(this.receiveCellMessage,this));this.setupKeyHandler()};colab.Notebook.prototype.getId=function(){return this.realtimeCells_.id};colab.Notebook.ANIMATION_DURATION_=400;
colab.Notebook.prototype.addNewCell=function(type,opt_position){if(!this.permissions_.isEditable())return;var realtimeCell=colab.cell.newRealtimeCell(this.model,type);var position=opt_position===undefined?this.realtimeCells_.length:opt_position;this.history_.recordInsert(position,realtimeCell)};colab.Notebook.prototype.isEditable=function(){return this.permissions_.isEditable()};
colab.Notebook.prototype.getCellIndex=function(id){return goog.array.findIndex(this.cells_,function(c){return c.realtimeCell.id==id})};colab.Notebook.prototype.findCellByCellId=function(cellId){return colab.cell.Cell.idToCellMap[cellId]};colab.Notebook.prototype.kernelAccessAllowed=function(cell){if(cell.getType()!=colab.cell.CellType.CODE)return false;return cell.getOutputArea().isLocalContent()};
colab.Notebook.prototype.receiveCellMessage=function(message){var data=((message.data));if(data.target!="notebook")return;var cell=this.findCellByCellId(data.cellId);if(cell==null||cell.getOutputArea().outputIframe.contentWindow!=message.source){colab.notification.showPrimary("Cell id did not match message source.");return}if(data.action=="send_message"){if(!this.kernelAccessAllowed(cell)){colab.notification.showPrimary("For security only locally run cells may communicate with kernel. "+"Re-run this cell.");
return}colabtools.sendMessageToKernel(data.tag,data.payload,function(code){colab.globalKernel.execute(code)});return}if(data.action=="execute_cell"){if(!this.kernelAccessAllowed(cell)){colab.notification.showPrimary("For security reasons, only locally run cells may request"+" cell execution. Re-run this cell. ");return}cell.execute(false)}if(data.action=="register_listener"){var listenerId=data.listenerId;var cellId=data.cellId;var listeners=this.listeners_[listenerId]||[];if(listeners.indexOf(cellId)<
0){listeners.push(cellId);this.listeners_[listenerId]=listeners}}if(data.action=="update_listener"){if(!this.kernelAccessAllowed(cell)){colab.notification.showPrimary("For security reasons, only locally run cells may update"+" listeners. Re-run this cell. ");return}var listenerCellIds=this.listeners_[data.listenerId]||[];var that=this;goog.array.forEach(listenerCellIds,function(cellId){var c=that.findCellByCellId(cellId);if(that.kernelAccessAllowed(c)&&(c.getOutputArea()&&c.getOutputArea().outputIframe.contentWindow))c.getOutputArea().outputIframe.contentWindow.postMessage({"listenerId":data.listenerId},
"*")})}if(data.action=="resize_cell_output")cell.getOutputArea().resizeOutput(data.desiredHeight)};colab.Notebook.prototype.moveCellUp=function(opt_realtimeCell){this.moveCell(-1,opt_realtimeCell)};colab.Notebook.prototype.moveCellDown=function(opt_realtimeCell){this.moveCell(1,opt_realtimeCell)};
colab.Notebook.prototype.moveCell=function(direction,opt_realtimeCell){if(!this.permissions_.isEditable())return;var realtimeCell=opt_realtimeCell;var selectedIndex=this.getCellIndex(this.selectedCellId_);if(realtimeCell===undefined)if(selectedIndex!=-1)realtimeCell=(this.realtimeCells_.get(selectedIndex));else{console.log("Could not move cell because no cell is selected");return}var index=this.realtimeCells_.indexOf(realtimeCell);if(index==-1){console.error("Could not find realtimeCell to move.");
return}var newIndex=index+direction;if(newIndex>=0&&newIndex<this.realtimeCells_.length){this.cellAdded_=realtimeCell.id;this.recordCellMove(realtimeCell,newIndex)}};colab.Notebook.prototype.recordCellMove=function(realtimeCell,newIndex){this.model.beginCompoundOperation();this.history_.recordMove(newIndex,realtimeCell);this.model.endCompoundOperation()};colab.Notebook.prototype.removeCell=function(realtimeCell){this.history_.recordDelete(realtimeCell)};colab.Notebook.prototype.undo=function(){this.history_.undo()};
colab.Notebook.prototype.redo=function(){this.history_.redo()};
colab.Notebook.prototype.setupKeyHandler=function(){var notebook=this;var docKh=new goog.events.KeyHandler(document);goog.events.listen(docKh,"key",function(e){if((e.shiftKey||(e.metaKey||(e.ctrlKey||e.altKey)))&&e.keyCode==goog.events.KeyCodes.ENTER){var nextCell=e.shiftKey||e.altKey;var create=e.altKey;notebook.runSelectedCell(nextCell,create);e.stopPropagation();e.preventDefault();return}if(document.activeElement.tagName=="TEXTAREA")return;if((e.metaKey||e.ctrlKey)&&(e.shiftKey&&e.keyCode==goog.events.KeyCodes.Z)){notebook.redo();
e.stopPropagation();e.preventDefault()}else if((e.metaKey||e.ctrlKey)&&e.keyCode==goog.events.KeyCodes.Z){notebook.undo();e.stopPropagation();e.preventDefault()}},false)};
colab.Notebook.prototype.realtimeCellsAdded_=function(e){var index=e.index;var values=e.values;var content=goog.dom.getElement("content");var correctedIndex;if(index==0||index==this.cells_.length)correctedIndex=index;else{var elementAbove=this.cells_[index-1].getElement();if(goog.dom.classes.has(elementAbove,"dragged"))correctedIndex=jQuery(elementAbove).index()+1;else{var elementBelow=this.cells_[index].getElement();correctedIndex=jQuery(elementBelow).index()}}if(!(correctedIndex==index||correctedIndex==
index-1))console.log("warning: encountered inconsistent index correction");for(var i=0;i<values.length;i++){var cell=colab.cell.cellFromRealtime(values[i],this.permissions_);cell.render(content);goog.dom.removeNode(cell.getElement());goog.array.insertAt(this.cells_,cell,index+i);goog.style.setElementShown(cell.getElement(),false);goog.dom.insertChildAt(content,cell.getElement(),correctedIndex+i);var anim=new goog.fx.dom.FadeInAndShow(cell.getElement(),colab.Notebook.ANIMATION_DURATION_);anim.play();
cell.refresh()}if(e.isLocal)this.selectCell(this.realtimeCells_.get(index+values.length-1).id);if(this.permissions_.isEditable())this.makeDraggable_()};
colab.Notebook.prototype.realtimeCellsRemoved_=function(e){var index=e.index;var values=e.values;for(var i=0;i<values.length;i++){var cellElem=this.cells_[index].getElement();goog.array.removeAt(this.cells_,index);if(e.isLocal)goog.dom.removeNode(cellElem);else{var anim=new goog.fx.dom.FadeOutAndHide(cellElem,colab.Notebook.ANIMATION_DURATION_);goog.events.listen(anim,goog.fx.Transition.EventType.END,function(){goog.dom.removeNode(cellElem)});anim.play()}}if(this.permissions_.isEditable())this.makeDraggable_()};
colab.Notebook.prototype.realtimeCellsSet_=function(e){var index=e.index;var values=e.newValues;var content=goog.dom.getElement("content");var children=goog.dom.getChildren(content);for(var i=0;i<values.length;i++){var cell=colab.cell.cellFromRealtime(values[i],this.permissions_);if(cell.getElement()==null){cell.render(content);goog.dom.removeNode(cell.getElement())}this.cells_[index+i]=cell;goog.dom.replaceNode(cell.getElement(),children[index+i]);cell.refresh()}if(this.permissions_.isEditable())this.makeDraggable_()};
colab.CellDragger=function(){goog.base(this)};goog.inherits(colab.CellDragger,goog.fx.DragListGroup);colab.CellDragger.prototype.createDragElementInternal=function(sourceEl){var element=goog.fx.Dragger.cloneNode(sourceEl);var iframes=element.getElementsByTagName("iframe");for(var i=0;i<iframes.length;i++)iframes[i].remove();goog.style.setWidth(element,goog.style.getSize(sourceEl).width);return element};
colab.Notebook.prototype.makeDraggable_=function(){var dlg=new colab.CellDragger;dlg.addDragList(goog.dom.getElement("content"),goog.fx.DragListDirection.DOWN,true);dlg.setDragItemHoverClass("dragged");dlg.setCurrDragItemClass("dragitem");dlg.init();goog.events.listen(dlg,goog.fx.DragListGroup.EventType.BEFOREDRAGSTART,goog.bind(function(e){if(!goog.dom.classes.has(e.event.target,"cell-handle")){e.preventDefault();return}this.selectCell(e.currDragItem.id);this.findCellByCellId(e.currDragItem.id).setDragging(true)},
this));goog.events.listen(dlg,goog.fx.DragListGroup.EventType.DRAGEND,goog.bind(function(e){this.findCellByCellId(e.draggerEl.id).setDragging(false);var insertIndex=jQuery("#"+e.draggerEl.id).index();var removeIndex=goog.array.findIndex(this.cells_,function(c){return c.realtimeCell.id==e.draggerEl.id});if(insertIndex!=removeIndex){var realtimeCell=(this.realtimeCells_.get(removeIndex));this.recordCellMove(realtimeCell,insertIndex)}else this.cells_[insertIndex].refresh()},this))};
colab.Notebook.prototype.selectedCell_=null;colab.Notebook.prototype.getSelectedCell=function(){return this.selectedCell_};
colab.Notebook.prototype.selectCell=function(id){if(!this.permissions_.isEditable())return;var prevSelectedId=this.selectedCellId_;this.selectedCellId_=id;var selectedCell=this.findCellByCellId(id);this.selectedCell_=selectedCell;if(!selectedCell||selectedCell.isSelected())return;var prevScrollY=window.scrollY;goog.array.forEach(this.cells_,function(cell){cell.setSelected(false)});window.scrollTo(window.scrollX,prevScrollY);selectedCell.setSelected(true);selectedCell.scrollIntoView();if(selectedCell.getType()==
colab.cell.CellType.CODE&&prevSelectedId!=this.selectedCellId_)selectedCell.focusOnEditor()};
colab.Notebook.prototype.runRange=function(startCell,endCell){if(!this.permissions_.isEditable()){colab.notification.showPrimary("Running read-only notebook is not yet supported.");return}startCell=Math.max(0,startCell);endCell=Math.min(this.cells_.length,endCell);for(var i=startCell;i<endCell;i++){var cell=this.cells_[i];if(cell.getType()==colab.cell.CellType.CODE&&!cell.isTrustedContent()){colab.notification.showPrimary(" Some cells were modified outside of this session. "+" For security reasons run this notebook manually first.");
return}}for(var i=startCell;i<endCell;i++){var cell=this.cells_[i];if(cell.getType()==colab.cell.CellType.CODE)cell.execute()}};colab.Notebook.prototype.runAll=function(){this.runRange(0,this.cells_.length)};colab.Notebook.prototype.runBefore=function(){var idx=this.getCellIndex(this.selectedCellId_);if(idx>=0)this.runRange(0,idx)};colab.Notebook.prototype.runAfter=function(){var idx=this.getCellIndex(this.selectedCellId_);if(idx>=0)this.runRange(idx,this.cells_.length)};
colab.Notebook.prototype.runSelectedCell=function(opt_nextCell,opt_insert){if(!this.permissions_.isEditable()){colab.notification.showPrimary("Running read-only notebooks is "+" not yet supported.");return}var selectedIndex=this.getCellIndex(this.selectedCellId_);if(selectedIndex==-1)return;var cell=this.cells_[selectedIndex];var executed=true;if(cell.getType()==colab.cell.CellType.CODE)executed=cell.execute(true);if(!opt_nextCell||!executed)return;if(selectedIndex==this.cells_.length-1||opt_insert){cell.setSelected(false);
this.addNewCell(colab.cell.CellType.CODE,selectedIndex+1)}else{cell=this.cells_[selectedIndex+1];this.selectCell(cell.realtimeCell.id)}};colab.Notebook.prototype.clear=function(){if(!this.permissions_.isEditable())return;this.realtimeCells_.clear()};colab.Notebook.prototype.close=function(){goog.array.forEach(this.cells_,function(cell){cell.close()})};
colab.Notebook.prototype.clearOutputs=function(){if(!this.permissions_.isEditable())return;goog.array.forEach(this.cells_,function(cell){if(cell.getType()===colab.cell.CellType.CODE)cell.clearOutput()})};goog.provide("colab");goog.require("colab.Header");goog.require("colab.Notebook");goog.require("colab.Presence");goog.require("colab.cell.Cell");goog.require("colab.dialog");goog.require("colab.drive");goog.require("colab.drive.Permissions");goog.require("colab.notification");goog.require("colab.params");goog.require("colab.sharing.SharingState");goog.require("goog.Promise");goog.require("goog.dom");goog.require("goog.events");goog.require("goog.events.KeyCodes");goog.require("goog.events.KeyHandler");
goog.require("goog.json");goog.require("goog.net.XhrIo");goog.require("goog.net.cookies");goog.require("goog.style");goog.require("goog.ui.Dialog");goog.require("goog.ui.Dialog.ButtonSet");goog.require("goog.ui.Dialog.ButtonSet.DefaultButtons");goog.require("goog.ui.ScrollFloater");goog.require("goog.ui.Toolbar");goog.require("goog.ui.ToolbarButton");goog.require("goog.ui.ToolbarSeparator");colab.IN_BROWSER_KERNEL_URL="app://";colab.NACL_KERNEL_URL="nacl://";
colab.appKernelDetails=new goog.Promise(function(resolve,reject){colab.app.addChromeAppListener(function(data,metadata){if(data==="initialization_message")resolve(metadata)})});
colab.recordAnalytics=function(document,opt_error){if(colab.params.getHashParams().mode=="app")return;var finishedLoading=new Date;window.setTimeout(function(){var user=document?document.getCollaborators().filter(function(d){return d.isMe}):"";var email="unknown";if(colab.drive.myInfo&&(colab.drive.myInfo.emails&&colab.drive.myInfo.emails.length))email=colab.drive.myInfo.emails[0].value;if(user)user=user[0];var params={"loadingTime":finishedLoading-window["pageLoadStart"],"user":user?user.displayName:
"unknown","userId":user?user.userId:"unknown","email":email,"title":document?colab.drive.getTitle():""};if(opt_error)params["errormessage"]="Error"+(opt_error.message||JSON.stringify(opt_error));var analyticsQuery=colab.params.encodeParamString(params);var xhrRequest=new XMLHttpRequest;xhrRequest.open("GET","/analytics?"+analyticsQuery,true);xhrRequest.send()},1E3)};colab.globalNotebook=null;colab.globalKernel=null;colab.globalSharingState=null;colab.globalRealtimeDoc=null;colab.globalMe=null;
colab.hashParams=colab.params.getHashParams();window.addEventListener("unload",function(){colab.close()});colab.close=function(cb){if(colab.globalNotebook){colab.globalNotebook.close();colab.globalNotebook=null}colab.drive.close(cb)};
window.addEventListener("load",function(){var loading=colab.notification.showNotification("Loading....","startup",-1);colab.drive.document.then(function(document){var error=null;try{colab.globalRealtimeDoc=document;colab.startPeriodicSaving();document.addEventListener(gapi.drive.realtime.EventType.COLLABORATOR_JOINED,colab.updateCollaborators);document.addEventListener(gapi.drive.realtime.EventType.COLLABORATOR_LEFT,colab.updateCollaborators);document.addEventListener(gapi.drive.realtime.EventType.DOCUMENT_SAVE_STATE_CHANGED,
colab.monitorSaveState);var collaboratorsList=colab.globalRealtimeDoc.getCollaborators();colab.globalMe=goog.array.find(collaboratorsList,function(c){return c.isMe});colab.updateCollaborators();var model=document.getModel();var permissions=new colab.drive.Permissions(!model.isReadOnly);colab.globalSharingState=new colab.sharing.SharingState(colab.drive.fileIdIfAvailable);var realtimeCells=model.getRoot().get("cells");colab.globalNotebook=new colab.Notebook(model,permissions);if(realtimeCells.length>
0)colab.globalNotebook.selectCell(realtimeCells.get(0).id);if(!goog.net.cookies.containsKey("kernelUrl")){var kernelUrl="http://127.0.0.1:8888/kernels";if(colab.app.appMode)kernelUrl=colab.IN_BROWSER_KERNEL_URL;goog.net.cookies.set("kernelUrl",kernelUrl,1E4)}colab.loadKernelFromUrl(goog.net.cookies.get("kernelUrl")||"");colab.setupHeader(document,permissions);var floater=new goog.ui.ScrollFloater;floater.decorate(goog.dom.getElement("top-floater"));IPython.mathjaxutils.init();loading.clear()}catch(err){loading.change("Error has occurred",
3E3);error=err;colab.dialog.displayError("Unable to load the framework.",err);colab.setupHeader(null,null);console.log(err)}colab.recordAnalytics(document,error)},function(reason){colab.dialog.displayError("Error creating/loading document.",reason);colab.setupHeader(null,null);loading.clear();colab.recordAnalytics(null,(reason))})});colab.SAVE_INTERVAL=1*30*1E3;colab.INVALIDATION_CHECK_INTERVAL=10*1E3;colab.invalidationDialogDisplayed=false;
colab.onDocumentInvalidation=function(opt_title,opt_reason,opt_button){if(colab.invalidationDialogDisplayed||colab.drive.isClosing)return;colab.invalidationDialogDisplayed=true;var title=opt_title||"File change detected";var reason=opt_reason||"The file on disk has been overwritten by another"+" application.  Please click the button below to save the current"+" version and reload.  All versions by you and other users are"+" available in the file's revision history, which can be accessed"+" from Google Drive.";
var dialog=new goog.ui.Dialog;dialog.setContent(reason);dialog.setTitle(title);var buttonSet=new goog.ui.Dialog.ButtonSet;var RELOAD_KEY="reload";buttonSet.addButton({key:RELOAD_KEY,caption:opt_button||"Reload From File"},false,false);dialog.setButtonSet(buttonSet);goog.events.listen(dialog,goog.ui.Dialog.EventType.SELECT,function(e){colab.reload()});dialog.setVisible(true);clearInterval(colab.uuid_checker);clearInterval(colab.autoSaver)};colab.reload=function(){colab.close(function(){window.location.reload()})};
colab.uuid_failed_note=null;
colab.startPeriodicSaving=function(){if(colab.globalRealtimeDoc.getModel().isReadOnly)return;colab.drive.fileId.promise.then(function(fileId){colab.uuid_checker=window.setInterval(function(){var model=null;try{model=colab.globalRealtimeDoc.getModel()}catch(e){colab.onDocumentInvalidation("Connection to the document lost","We no longer have live connection to google drive servers. "+"This might be caused by the change of network."+"Any further changes will not be saved. Please reload this page. ","Reload");
clearInterval(colab.uuid_checker);return}colab.drive.checkModelUUID(model,fileId,function(isMatch){if(!isMatch)colab.onDocumentInvalidation()},function(response){if(response==="Error getting document UUID")return;if(colab.uuid_failed_note)colab.uuid_failed_note.clear();console.log("Error obtaining UUID",response)})},colab.INVALIDATION_CHECK_INTERVAL)});colab.autoSaver=window.setInterval(function(){colab.drive.saveDocument(colab.globalRealtimeDoc,function(){},function(reason){console.log(reason)})},
colab.SAVE_INTERVAL)};colab.authorizeKernel=function(url,callback){url=new window["URL"](url);var childWindow=window.open(url.protocol+"//"+url.hostname+":"+url.port+"/oauthlogin","_blank","width=600, height=500");var checkWindow=function(){if(childWindow&&childWindow.closed){window.clearInterval(intervalID);callback()}};var intervalID=window.setInterval(checkWindow,100)};
colab.loadKernelFromUrl=function(url,opt_forceAuthorization){opt_forceAuthorization=opt_forceAuthorization&&!colab.app.appMode;opt_forceAuthorization=opt_forceAuthorization&&!(url===colab.IN_BROWSER_KERNEL_URL||url===colab.NACL_KERNEL_URL);if(opt_forceAuthorization){colab.authorizeKernel(url,goog.partial(colab.loadKernelFromUrl,url,false));return}goog.net.cookies.set("kernelUrl",url,1E4);if(colab.globalKernel){colab.globalKernel.kill();colab.globalKernel.stop_channels()}if(url===colab.IN_BROWSER_KERNEL_URL)colab.appKernelDetails.then(function(details){var options=
({in_browser_kernel:true,kernel_origin:details.origin,kernel_window:details.source});colab.globalKernel=new IPython.Kernel(url,options);colab.globalKernel.start(colab.globalNotebook.getId())});else{colab.globalKernel=new IPython.Kernel(url);colab.globalKernel.start(colab.globalNotebook.getId())}};
colab.openKernelDialogBox=function(){var dialog=new goog.ui.Dialog;dialog.setDisposeOnHide(true);var contentDiv=dialog.getContentElement();goog.style.setWidth(contentDiv,400);var textDiv=goog.dom.createDom("div");textDiv.innerHTML="Enter the url for a python backend (kernel)."+'See <a href="http://goto.google.com/colab-external-kernel" '+' target="_blank"/> for how to setup your own python backend.';goog.dom.appendChild(contentDiv,textDiv);var urlInput=goog.dom.createDom("input",{"id":"backend-url-input"});
goog.style.setWidth(urlInput,300);urlInput.value=colab.globalKernel.base_url;goog.dom.appendChild(contentDiv,urlInput);dialog.setTitle("Connect to Kernel");goog.events.listen(dialog,goog.ui.Dialog.EventType.SELECT,function(e){if(e.key=="ok"){var url=goog.dom.getElement("backend-url-input").value;colab.loadKernelFromUrl(url,true)}});dialog.setVisible(true)};
colab.services.setKernelRequestListener("get_access_token",function(content,callback){var dialog=new goog.ui.Dialog;dialog.setDisposeOnHide(true);dialog.setContent("The kernel is requesting access to Google Drive."+" Do you want to allow python code to access your Google Drive files?");dialog.setTitle("File change detected");dialog.setButtonSet(goog.ui.Dialog.ButtonSet.createYesNoCancel());goog.events.listen(dialog,goog.ui.Dialog.EventType.SELECT,function(e){var reply={"error":{"type":"USER_DENIED_ERROR",
"description":"The user refused to provide the"+" OAuth token"}};if(e.key===goog.ui.Dialog.DefaultButtonKeys.YES)reply=gapi.auth.getToken()["access_token"];callback(reply)});dialog.setVisible(true)});colab.userAlarmTimer=0;colab.notSavedSince=null;colab.realtimeSaveFailureNote=colab.notification.createEmptyNotification();
colab.monitorSaveState=function(ev){if(!ev.isSaving&&!ev.isPending){colab.notSavedSince=null;colab.realtimeSaveFailureNote.clear();clearInterval(colab.userAlarmTimer);return}if(!colab.notSavedSince){colab.notSavedSince=new Date;colab.userAlarmTimer=setInterval(function(){var x=Math.round((new Date-colab.notSavedSince)/1E3/60)+" minutes";var msg="Realtime save failed for "+x+"."+"Data loss is possible. Reopen in a new tab to ensure validity.";colab.realtimeSaveFailureNote.change(msg,-1)},60*1E3)}colab.saveState=
ev;if(Date()-colab.notSavedSince>3E4)console.log("Save state is (in flight: ",ev.isSaving," pending: ",ev.isPending+")")};
